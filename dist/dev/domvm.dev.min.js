// https://github.com/leeoniya/domvm (3.x-dev, dev build)
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.domvm=t()}(this,function(){"use strict";var e=1,t=2,n=3,l=4,r=5,o="undefined"!=typeof window,a=o?window:{},i=o?document:{},u=a.requestAnimationFrame,s={};function d(){}var f=Array.isArray;function c(e){return null!=e&&e.constructor===Object}function v(e){return"function"==typeof e}function y(e){for(var t=arguments,n=1;n<t.length;n++)for(var l in t[n])e[l]=t[n][l];return e}function p(e,t){for(var n=[],l=t;l<e.length;l++)n.push(e[l]);return n}function m(e,t){for(var n in e)if(e[n]!==t[n])return!1;return!0}function h(e,t){var n=e.length;if(t.length!==n)return!1;for(var l=0;l<n;l++)if(e[l]!==t[l])return!1;return!0}function g(e){if(!u)return e;var t,n,l;function r(){t=0,e.apply(n,l)}return function(){n=this,l=arguments,t||(t=u(r))}}function b(e){return"o"===e[0]&&"n"===e[1]}function _(e){return"_"===e[0]}function w(e){return"style"===e}function k(e){e&&e.el&&e.el.offsetHeight}function E(e){return null!=e.node&&null!=e.node.el}function x(e,t){switch(t){case"value":case"checked":case"selected":return!0}return!1}function A(e){for(e=e||s;null==e.vm&&e.parent;)e=e.parent;return e.vm}function T(){}var N=T.prototype={constructor:T,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null};function D(e){var n=new T;return n.type=t,n.body=e,n}var R=function(){return!1},C=d,S=d,M=d;function L(e,t){var n=S(e,function(e){n&&(null!=t.node&&t.redraw(),M(n))});return C(e)}function I(e,t){var n=S(e,function(e){n&&null!=t.node&&t.redraw()});return n}var O={},H=/\[(\w+)(?:=(\w+))?\]/g;var Y={warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(e,t,n){if(v(e.view)&&e.view.length>1){return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",e,t,n]}},UNKEYED_INPUT:function(e){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",e]},UNMOUNTED_REDRAW:function(e){return["Invoking redraw() of an unmounted (sub)view may result in errors.",e]},INLINE_HANDLER:function(e,t,n){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",e,t,n]},MISMATCHED_HANDLER:function(e,t,n){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",e,t,n]},SVG_WRONG_FACTORY:function(e){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",e]},FOREIGN_ELEMENT:function(e){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",e]},REUSED_ATTRS:function(e){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",e]},ADJACENT_TEXT:function(e,t,n){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",e,t,n]},ARRAY_FLATTENED:function(e,t){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",e,t]},ALREADY_HYDRATED:function(e){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",e]},ATTACH_IMPLICIT_TBODY:function(e,t){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",e,t]}};function U(e,t){if(Y.warnings&&v(Y[e])){var n=Y[e].apply(null,t);n&&(n[0]=e+": "+(Y.verbose?n[0]:""),console.warn.apply(console,n))}}var V=1,j=2,F=4,P=8;function G(t,n,l,r){var o=new T;o.type=e,o.flags=r||0,o.attrs=n||null;var a=function(e){var t,n,l,r,o=O[e];if(null==o)for(O[e]=o={tag:(t=e.match(/^[-\w]+/))?t[0]:"div",id:(n=e.match(/#([-\w]+)/))?n[1]:null,class:(l=e.match(/\.([-\w.]+)/))?l[1].replace(/\./g," "):null,attrs:null};r=H.exec(e);)null==o.attrs&&(o.attrs={}),o.attrs[r[1]]=r[2]||"";return o}(t);o.tag=a.tag;var i=null!=a.id,u=null!=a.class,s=null!=a.attrs;if(i||u||s){var d=o.attrs||{};if(i&&null==d.id&&(d.id=a.id),u&&(o._class=a.class,d.class=a.class+(null!=d.class?" "+d.class:"")),s)for(var f in a.attrs)null==d[f]&&(d[f]=a.attrs[f]);o.attrs=d}var c=o.attrs;return null!=c&&(null!=c._key&&(o.key=c._key),null!=c._ref&&(o.ref=c._ref),null!=c._hooks&&(o.hooks=c._hooks),null!=c._data&&(o.data=c._data),null!=c._flags&&(o.flags=c._flags),null==o.key&&(null!=o.ref?o.key=o.ref:null!=c.id?o.key=c.id:null!=c.name&&(o.key=c.name+("radio"===c.type||"checkbox"===c.type?c.value:"")))),null!=l&&(o.body=l),"svg"===o.tag?setTimeout(function(){null==o.ns&&U("SVG_WRONG_FACTORY",[o])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(o.tag)&&null==o.key&&U("UNKEYED_INPUT",[o]),o}function W(e,n,o,a){if(e.type!==r&&e.type!==l){var i,u,s;e.parent=n,e.idx=o,e.vm=a,null!=e.ref&&(i=A(e),u=e.ref,s=e,function(e,t,n){for(var l;l=t.shift();)0===t.length?e[l]=n:e[l]=e=e[l]||{}}(i,["refs"].concat(u.split(".")),s));var d=e.hooks,c=a&&a.hooks;(d&&(d.willRemove||d.didRemove)||c&&(c.willUnmount||c.didUnmount))&&function(e){for(;e=e.parent;)e.flags|=V}(e),f(e.body)?function(e){for(var n=e.body,l=0;l<n.length;l++){var r=n[l];!1===r||null==r?n.splice(l--,1):f(r)?(0!==l&&l!==n.length-1||U("ARRAY_FLATTENED",[e,r]),a=r,i=l--,u=1,(o=n).splice.apply(o,[i,u].concat(a))):(null==r.type&&(n[l]=r=D(""+r)),r.type===t?null==r.body||""===r.body?n.splice(l--,1):l>0&&n[l-1].type===t?(U("ADJACENT_TEXT",[e,n[l-1].body,r.body]),n[l-1].body+=r.body,n.splice(l--,1)):W(r,e,l,null):W(r,e,l,null))}var o,a,i,u}(e):""===e.body?e.body=null:R(e.body)&&(e.body=L(e.body,A(e)))}}var z={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function B(e,t){return isNaN(t)||z[e]?t:t+"px"}function K(e,t){var n,l=(e.attrs||s).style,r=t?(t.attrs||s).style:null;if(null==l||("string"===(n=typeof l)||"number"===n))e.el.style.cssText=l;else{for(var o in l){var a=l[o];R(a)&&(l[o]=a=L(a,A(e))),(null==r||null!=a&&a!==r[o])&&(e.el.style[o]=B(o,a))}if(r)for(var i in r)null==l[i]&&(e.el.style[i]="")}}var X=[];function $(e,t,n,l,r){if(null!=e){var o=n.hooks[t];if(o){if("d"!==t[0]||"i"!==t[1]||"d"!==t[2])return o(n,l);r?k(n.parent)&&o(n,l):X.push([o,n,l])}}}function q(e){var t;if(X.length)for(k(e.node);t=X.shift();)t[0](t[1],t[2])}function J(e){return e.nextSibling}function Z(e,t,n){var l=t._node,r=l.vm;if(f(l.body))if((l.flags&V)===V)for(var o=0;o<l.body.length;o++)Z(t,l.body[o].el);else ee(l);delete t._node,e.removeChild(t),$(l.hooks,"didRemove",l,null,n),null!=r&&($(r.hooks,"didUnmount",r,r.data,n),r.node=null)}function Q(e,t){var n=t._node;if(!n._dead){var l,r,o,a,i=function e(t){var n=t.vm,l=null!=n&&$(n.hooks,"willUnmount",n,n.data),r=$(t.hooks,"willRemove",t);if((t.flags&V)===V&&f(t.body))for(var o=0;o<t.body.length;o++)e(t.body[o]);return l||r}(n);null!=i&&("object"==typeof(a=i)&&v(a.then))?(n._dead=!0,i.then((l=Z,r=[e,t,!0],function(){return l.apply(o,r)}))):Z(e,t)}}function ee(e){for(var t=e.body,n=0;n<t.length;n++){var l=t[n];delete l.el._node,null!=l.vm&&(l.vm.node=null),f(l.body)&&ee(l)}}function te(e){var t=e.el;if(0==(e.flags&V))f(e.body)&&ee(e),t.textContent=null;else{var n=t.firstChild;do{var l=J(n);Q(t,n)}while(n=l)}}function ne(e,t,n){var l=t._node,r=null!=t.parentNode,o=t!==n&&r?null:l.vm;null!=o&&$(o.hooks,"willMount",o,o.data),$(l.hooks,r?"willReinsert":"willInsert",l),e.insertBefore(t,n),$(l.hooks,r?"didReinsert":"didInsert",l),null!=o&&$(o.hooks,"didMount",o,o.data)}function le(e,t,n){ne(e,t,n?J(n):null)}var re={};var oe=d,ae=!1;function ie(e,t,n){e[t]=n}function ue(e,t,n,l,r){var o=e.apply(r,t.concat([n,l,r,r.data]));r.onevent(n,l,r,r.data,t),oe.call(null,n,l,r,r.data,t),!1===o&&(n.preventDefault(),n.stopPropagation())}function se(e){var t,n,l=function(e){for(;null==e._node;)e=e.parentNode;return e._node}(e.target),r=A(l),o=e.currentTarget._node.attrs["on"+e.type];if(f(o))ue(t=o[0],n=o.slice(1),e,l,r);else for(var a in o)if(e.target.matches(a)){var i=o[a];f(i)?(t=i[0],n=i.slice(1)):(t=i,n=[]),ue(t,n,e,l,r)}}function de(e,t,n,l){if(n!==l){v(n)&&v(l)&&l.name==n.name&&U("INLINE_HANDLER",[e,l,n]),null==l||null==n||f(l)==f(n)&&c(l)==c(n)&&v(l)==v(n)||U("MISMATCHED_HANDLER",[e,l,n]);var r=e.el;null==n||v(n)?ie(r,t,n):null==l&&ie(r,t,se)}}function fe(e,t,n,l,r){var o=e.el;null!=e.ns?o.setAttribute(t,n):"class"===t?o.className=n:"id"===t||"boolean"==typeof n||l?o[t]=n:"."===t[0]?o[t.substr(1)]=n:o.setAttribute(t,n)}function ce(e,t,n){var l,r,o,a=e.attrs||s,i=t.attrs||s;if(a===i)U("REUSED_ATTRS",[e]);else{for(var u in a){var d=a[u];if(null!=d){var f=x(e.tag,u),c=f?e.el[u]:i[u];R(d)&&(a[u]=d=L(d,A(e))),d===c||(w(u)?K(e,t):_(u)||(b(u)?de(e,u,d,c):fe(e,u,d,f)))}}for(var u in i)null==a[u]&&!_(u)&&(l=e,r=u,o=x(e.tag,u)||b(u),"."===r[0]&&(r=r.substr(1),o=!0),o?l.el[r]="":l.el.removeAttribute(r))}}function ve(e,t,n,r){return e.type===l&&(t=e.data,n=e.key,r=e.opts,e=e.view),new De(e,t,n,r)}function ye(e){for(var t=0;t<e.body.length;t++){var o=e.body[t],a=o.type;if(a<=n)ne(e.el,pe(o));else if(a===l){a=(i=ve(o.view,o.data,o.key,o.opts)._redraw(e,t,!1)).node.type,ne(e.el,pe(i.node))}else if(a===r){var i;(i=o.vm)._redraw(e,t),a=i.node.type,ne(e.el,i.node.el)}}}function pe(l,r){var o,a,u,d;return null==l.el&&(l.type===e?(l.el=r||(u=l.tag,null!=(d=l.ns)?i.createElementNS(d,u):i.createElement(u)),null!=l.attrs&&ce(l,s),(l.flags&P)===P&&l.body.body(l),f(l.body)?ye(l):null!=l.body&&(l.el.textContent=l.body)):l.type===t?l.el=r||(a=l.body,i.createTextNode(a)):l.type===n&&(l.el=r||(o=l.body,i.createComment(o)))),l.el._node=l,l.el}var me=1,he=2;function ge(e,t,n,l,r,o,a,i){return function(u,s,d,f,c,v){var y,p;if(null!=f[l]){if(null==(y=f[l]._node))return U("FOREIGN_ELEMENT",[f[l]]),void(f[l]=e(f[l]));if(y.parent!==u)return p=e(f[l]),null!=y.vm?y.vm.unmount(!0):Q(s,f[l]),void(f[l]=p)}if(f[r]==c)return he;if(null==f[r].el)n(s,pe(f[r]),f[l]),f[r]=t(f[r],d);else if(f[r].el===f[l])f[r]=t(f[r],d),f[l]=e(f[l]);else{if(v||y!==f[a])return null!=f[r].vm&&U("ALREADY_HYDRATED",[f[r].vm]),v&&null!=f[l]?function(e,t,n,l,r,o,a,i,u){if(i._lis)n(o,u[r].el,u[l]),u[r]=t(u[r],a);else{var s=function(e,t){var n,l=0,r=t.length-1;if(r<=2147483647)for(;l<=r;){if(t[n=l+r>>1]===e)return n;t[n]<e?l=n+1:r=n-1}else for(;l<=r;){if(t[n=Math.floor((l+r)/2)]===e)return n;t[n]<e?l=n+1:r=n-1}return l==t.length?null:l}(i.idx,u.tombs);i._lis=!0;var d=e(u[l]);n(o,u[l],null!=s?a[u.tombs[s]].el:s),null==s?u.tombs.push(i.idx):u.tombs.splice(s,0,i.idx),u[l]=d}}(e,t,n,l,r,s,d,y,f):me;p=f[l],f[l]=e(p),i(s,p,f[o]),f[o]=p}}}var be=ge(J,function(e,t){return t[e.idx+1]},ne,"lftSib","lftNode","rgtSib","rgtNode",le),_e=ge(function(e){return e.previousSibling},function(e,t){return t[e.idx-1]},le,"rgtSib","rgtNode","lftSib","lftNode",ne);function we(e,t,n,l){for(var r=[],o=r.slice.call(t.childNodes),a=0;a<o.length;a++){var i=o[a]._node;i.parent===e&&r.push(i.idx)}for(var u=function(e){var t,n,l=e.slice(),r=[];r.push(0);for(var o=0,a=e.length;o<a;++o){var i=r[r.length-1];if(e[i]<e[o])l[o]=i,r.push(o);else{for(t=0,n=r.length-1;t<n;){var u=(t+n)/2|0;e[r[u]]<e[o]?t=u+1:n=u}e[o]<e[r[t]]&&(t>0&&(l[o]=r[t-1]),r[t]=o)}}for(n=r[(t=r.length)-1];t-- >0;)r[t]=n,n=l[n];return r}(r).map(function(e){return r[e]}),s=0;s<u.length;s++)n[u[s]]._lis=!0;for(l.tombs=u;;){if(be(e,t,n,l,null,!0)===he)break}}function ke(e){return e.el._node.parent!==e.parent}function Ee(e,t,n){return t[n]}function xe(e,t,n){for(;n<t.length;n++){var o=t[n];if(null!=o.vm){if(e.type===l&&o.vm.view===e.view&&o.vm.key===e.key||e.type===r&&o.vm===e.vm)return o}else if(!ke(o)&&e.tag===o.tag&&e.type===o.type&&e.key===o.key&&(e.flags&~V)==(o.flags&~V))return o}return null}function Ae(e,t,n){if(null==t._keys){if(t[n].key===e.key)return t[n];for(var l={},r=0;r<t.length;r++)l[t[r].key]=r;t._keys=l}return t[t._keys[e.key]]}function Te(o,a){$(a.hooks,"willRecycle",a,o);var i=o.el=a.el,u=a.body,c=o.body;if(i._node=o,o.type!==t||c===u){null==o.attrs&&null==a.attrs||ce(o,a);var v=f(u),y=f(c),p=(o.flags&P)===P;v?y||p?function(t,o){var a=t.body,i=a.length,u=o.body,f=u.length,c=(t.flags&P)===P,v=(t.flags&j)===j,y=(t.flags&F)===F,p=!v&&t.type===e,m=!0,h=0===f?d:y?Ae:v||c?Ee:xe;if(p&&0===i)return te(o),void(c&&(t.body=[]));var g,b,_=0,w=!1,k=0;if(c)var x={key:null},A=Array(i);for(var T=0;T<i;T++){if(c){var N=!1,D=null;m&&(y&&(x.key=a.key(T)),g=h(x,u,k)),null!=g?(b=g.idx,!0===(D=a.diff(T,g))?((R=g).parent=t,R.idx=T,R._lis=!1):N=!0):N=!0,N&&(W(R=a.tpl(T),t,T),R._diff=null!=D?D:a.diff(T),null!=g&&Te(R,g)),A[T]=R}else{var R=a[T],C=R.type;if(C<=n)(g=m&&h(R,u,k))&&(Te(R,g),b=g.idx);else if(C===l){if(g=m&&h(R,u,k)){b=g.idx;var S=g.vm._update(R.data,t,T)}else var S=ve(R.view,R.data,R.key,R.opts)._redraw(t,T,!1);C=S.node.type}else if(C===r){var M=E(R.vm),S=R.vm._update(R.data,t,T,M);C=S.node.type}}if(null!=g&&(b===k?++k===f&&i>f&&(g=null,m=!1):w=!0,!y&&f>100&&w&&++_%10==0))for(;k<f&&ke(u[k]);)k++}c&&(t.body=A);p&&function(e,t){var n=t.body,l=e.el,r=e.body,o={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(n[0]||s).el,rgtSib:(n[n.length-1]||s).el};e:for(;;){for(;;){var a=be(e,l,r,o,null,!1);if(a===me)break;if(a===he)break e}for(;;){var i=_e(e,l,r,o,o.lftNode,!1);if(i===me)break;if(i===he)break e}we(e,l,r,o);break}}(t,o)}(o,a):c!==u&&(null!=c?i.textContent=c:te(a)):y?(te(a),ye(o)):c!==u&&(null!=c&&null!=u?i.firstChild.nodeValue=c:i.textContent=c),$(a.hooks,"didRecycle",a,o)}else i.nodeValue=c}var Ne=null;function De(e,t,n,l){var r=this;r.view=e,r.data=t,r.key=n,R(t)&&(r._stream=I(t,r)),l&&(r.opts=l,r.config(l));var o=c(e)?e:e.call(r,r,t,n,l);v(o)?r.render=o:(r.render=o.render,r.config(o)),r.init&&r.init.call(r,r,r.data,r.key,l)}Y.mutations&&(Ne=new function(e){navigator.userAgent.indexOf("Edge");var t=-1!==navigator.userAgent.indexOf("Trident/"),n=Object.getOwnPropertyDescriptor,l=Object.defineProperty,r=Node.prototype,o=n(r,"textContent"),a=n(r,"nodeValue"),i=HTMLElement.prototype,u=n(i,"innerText"),s=Element.prototype,d=n(t?i:s,"innerHTML"),f=n(t?i:s,"className"),c=n(t?i:s,"id"),v=CSSStyleDeclaration.prototype,y=n(v,"cssText"),p=HTMLInputElement.prototype,m=HTMLTextAreaElement.prototype,h=HTMLSelectElement.prototype,g=HTMLOptionElement.prototype,b=n(p,"checked"),_=n(p,"value"),w=n(m,"value"),k=n(h,"value"),E=n(h,"selectedIndex"),x=n(g,"selected"),A={"document.createElement":null,"document.createElementNS":null,"document.createTextNode":null,"document.createComment":null,"document.createDocumentFragment":null,"DocumentFragment.prototype.insertBefore":null,"Element.prototype.appendChild":null,"Element.prototype.removeChild":null,"Element.prototype.insertBefore":null,"Element.prototype.replaceChild":null,"Element.prototype.remove":null,"Element.prototype.setAttribute":null,"Element.prototype.setAttributeNS":null,"Element.prototype.removeAttribute":null,"Element.prototype.removeAttributeNS":null},T={},N=null;function D(e){for(var t=e.split("."),n=window;t.length>1;)n=n[t.shift()];return{ctx:n,last:t[0]}}for(var R in A){var C=D(R);null===A[R]&&(A[R]=C.ctx[C.last]),function(e,t){T[t]=0,C.ctx[t]=function(){return T[t]++,A[e].apply(this,arguments)}}(R,C.last)}T.textContent=0,l(r,"textContent",{set:function(e){T.textContent++,o.set.call(this,e)}}),T.nodeValue=0,l(r,"nodeValue",{set:function(e){T.nodeValue++,a.set.call(this,e)}}),T.innerText=0,l(i,"innerText",{set:function(e){T.innerText++,u.set.call(this,e)}}),T.innerHTML=0,l(t?i:s,"innerHTML",{set:function(e){T.innerHTML++,d.set.call(this,e)}}),T.className=0,l(t?i:s,"className",{set:function(e){T.className++,f.set.call(this,e)}}),T.cssText=0,l(v,"cssText",{set:function(e){T.cssText++,y.set.call(this,e)}}),T.id=0,l(t?i:s,"id",{set:function(e){T.id++,c.set.call(this,e)}}),T.checked=0,l(p,"checked",{set:function(e){T.checked++,b.set.call(this,e)}}),T.value=0,l(p,"value",{set:function(e){T.value++,_.set.call(this,e)}}),l(m,"value",{set:function(e){T.value++,w.set.call(this,e)}}),l(h,"value",{set:function(e){T.value++,k.set.call(this,e)}}),T.selectedIndex=0,l(h,"selectedIndex",{set:function(e){T.selectedIndex++,E.set.call(this,e)}}),T.selected=0,l(g,"selected",{set:function(e){T.selected++,x.set.call(this,e)}}),this.start=function(){N=+new Date},this.end=function(){var t=+new Date-N;N=null;var n={};for(var l in T)T[l]>0&&(n[l]=T[l]);return function(){for(var e in T)T[e]=0}(),e&&(n._time=t),n}}(!0));var Re=De.prototype={constructor:De,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:d,refs:null,render:null,mount:function(e,t){var n=this;Y.mutations&&Ne.start();t?(te({el:e,flags:0}),n._redraw(null,null,!1),e.nodeName.toLowerCase()!==n.node.tag?(pe(n.node),ne(e.parentNode,n.node.el,e),e.parentNode.removeChild(e)):ne(e.parentNode,pe(n.node,e),e)):(n._redraw(null,null),e&&ne(e,n.node.el));e&&q(n);Y.mutations&&console.log(Ne.end());return n},unmount:function(e){R(this._stream)&&M(this._stream);var t=this.node;Q(t.el.parentNode,t.el),e||q(this)},config:function(e){var t=this;e.init&&(t.init=e.init),e.diff&&(t.diff=e.diff),e.onevent&&(t.onevent=e.onevent),e.hooks&&(t.hooks=y(t.hooks||{},e.hooks)),e.onemit&&(t.onemit=y(t.onemit||{},e.onemit))},parent:function(){return A(this.node.parent)},root:function(){for(var e=this.node;e.parent;)e=e.parent;return e.vm},redraw:function(e){null==e&&(e=ae);var t=this;return e?t._redraw(null,null,E(t)):(t._redrawAsync=t._redrawAsync||g(function(e){return t.redraw(!0)}))(),t},update:function(e,t){null==t&&(t=ae);var n=this;return t?n._update(e,null,null,E(n)):(n._updateAsync=n._updateAsync||g(function(e){return n.update(e,!0)}))(e),n},_update:function(e,t,n,l){var r=this;null!=e&&r.data!==e&&(U("DATA_REPLACED",[r,r.data,e]),$(r.hooks,"willUpdate",r,e),r.data=e,R(r._stream)&&M(r._stream),R(e)&&(r._stream=I(e,r)));return r._redraw(t,n,l)},_redraw:function(e,t,n){var l=null==e,r=this,o=r.node&&r.node.el&&r.node.el.parentNode;l&&r.node&&r.node.el&&!r.node.el.parentNode&&U("UNMOUNTED_REDRAW",[r]);l&&Y.mutations&&o&&Ne.start();var a,i,u=r.node;if(null!=r.diff&&(a=r._diff,r._diff=i=r.diff(r,r.data),null!=u)){var s=f(a)?h:m,d=a===i||s(a,i);if(d)return Ce(r,u,e,t)}o&&$(r.hooks,"willRedraw",r,r.data);var c=r.render.call(r,r,r.data,a,i);if(c===u)return Ce(r,u,e,t);r.refs=null,null!=r.key&&c.key!==r.key&&(c.key=r.key);r.node=c,e?(W(c,e,t,r),e.body[t]=c):u&&u.parent?(W(c,u.parent,u.idx,r),u.parent.body[u.idx]=c):W(c,null,null,r);if(!1!==n)if(u)if(u.tag!==c.tag||u.key!==c.key){u.vm=c.vm=null;var v=u.el.parentNode,y=J(u.el);Q(v,u.el),ne(v,pe(c),y),u.el=c.el,c.vm=r}else Te(c,u);else pe(c);o&&$(r.hooks,"didRedraw",r,r.data),l&&o&&q(r);l&&Y.mutations&&o&&console.log(Ne.end());return r},_redrawAsync:null,_updateAsync:null};function Ce(e,t,n,l){return null!=n&&(n.body[l]=t,t.idx=l,t.parent=n,t._lis=!1),e}function Se(e,t,n,l){var r,o;return null==n?c(t)?r=t:o=t:(r=t,o=n),G(e,r,o,l)}var Me="http://www.w3.org/2000/svg";function Le(e,t,n,l){this.view=e,this.data=t,this.key=n,this.opts=l}function Ie(e){this.vm=e}Le.prototype={constructor:Le,type:l,view:null,data:null,key:null,opts:null},Ie.prototype={constructor:Ie,type:r,vm:null};var Oe={config:function(e){var t,n;oe=e.onevent||oe,null!=e.syncRedraw&&(ae=e.syncRedraw),e.onemit&&(t=e.onemit,y(re,t)),e.stream&&(n=e.stream,R=n.is,C=n.val,S=n.sub,M=n.unsub)},ViewModel:De,VNode:T,createView:ve,defineElement:Se,defineSvgElement:function(e,t,n,l){var r=Se(e,t,n,l);return r.ns=Me,r},defineText:D,defineComment:function(e){var t=new T;return t.type=n,t.body=e,t},defineView:function(e,t,n,l){return new Le(e,t,n,l)},injectView:function(e){return new Ie(e)},injectElement:function(t){var n=new T;return n.type=e,n.el=n.key=t,n},lazyList:function(e,t){var n=e.length,l={items:e,length:n,key:function(n){return t.key(e[n],n)},diff:function(n,l){var r=t.diff(e[n],n);if(null==l)return r;var o=l._diff;return(r===o||f(o)?h(r,o):m(r,o))||r},tpl:function(n){return t.tpl(e[n],n)},map:function(e){return t.tpl=e,l},body:function(e){for(var t=Array(n),r=0;r<n;r++){var o=l.tpl(r);o._diff=l.diff(r),t[r]=o,W(o,e,r)}e.body=t}};return l},FIXED_BODY:j,DEEP_REMOVE:V,KEYED_LIST:F,LAZY_LIST:P};function He(e){var t,n,l=arguments,r=l.length;if(r>1){var o=1;c(l[1])&&(n=l[1],o=2),t=r!==o+1||l[o]instanceof T||l[o]instanceof Le||l[o]instanceof Ie?p(l,o):l[o]}return G(e,n,t)}function Ye(e){var t="";for(var n in e)null!=e[n]&&(t+=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+B(n,e[n])+"; ");return t}function Ue(e){return null==e?"":""+e}N.patch=function(e,t){!function(e,t,n){if(null!=t.type){if(null!=e.vm)return;W(t,e.parent,e.idx,null),e.parent.body[e.idx]=t,Te(t,e),n&&k(t),q(A(t))}else{var l=Object.create(e);l.attrs=y({},e.attrs);var r=y(e.attrs,t);if(null!=e._class){var o=r.class;r.class=null!=o&&""!==o?e._class+" "+o:e._class}ce(e,l),n&&k(e)}}(this,e,t)},Re.emit=function(e){var t=this,n=t,l=p(arguments,1).concat(n,n.data);do{var r=t.onemit,o=r?r[e]:null;if(o){o.apply(t,l);break}}while(t=t.parent());re[e]&&re[e].apply(t,l)},Re.onemit=null,Re.body=function(){return function e(t,n){var l=t.body;if(f(l))for(var r=0;r<l.length;r++){var o=l[r];null!=o.vm?n.push(o.vm):e(o,n)}return n}(this.node,[])},Oe.defineElementSpread=He,Oe.defineSvgElementSpread=function(){var e=He.apply(null,arguments);return e.ns=Me,e},Re._stream=null;var Ve={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function je(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)switch(e[t]){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=e[t]}return n}function Fe(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)n+='"'===e[t]?"&quot;":e[t];return n}function Pe(e,t){for(var n="",l=0;l<e.length;l++)n+=We(e[l],t);return n}var Ge=".innerHTML";function We(o,a){var i,u;switch(o.type){case l:i=ve(o.view,o.data,o.key,o.opts).html(a);break;case r:i=o.vm.html();break;case e:if(null!=o.el&&null==o.tag){i=o.el.outerHTML;break}var s="";s+="<"+o.tag;var d=o.attrs,c=null!=d;if(c){for(var v in d)if(!(b(v)||"."===v[0]||"_"===v[0]||!1===a&&x(o.tag,v))){var y=d[v];"style"!==v||null==y?!0===y?s+=" "+je(v)+'=""':!1===y||null!=y&&(s+=" "+je(v)+'="'+Fe(y)+'"'):u="object"==typeof y?Ye(y):y}null!=u&&(s+=' style="'+Fe(u.trim())+'"')}if(null==o.body&&null!=o.ns&&"svg"!==o.tag)return s+"/>";s+=">",Ve[o.tag]||(c&&null!=d[Ge]?s+=d[Ge]:f(o.body)?s+=Pe(o.body,a):(o.flags&P)===P?(o.body.body(o),s+=Pe(o.body,a)):s+=je(o.body),s+="</"+o.tag+">"),i=s;break;case t:i=je(o.body);break;case n:i="\x3c!--"+je(o.body)+"--\x3e"}return i}return Re.attach=function(e){return null==this.node&&this._redraw(null,null,!1),function e(t,n){t.el=n,n._node=t;var o=t.attrs;for(var a in o){var i=o[a],u=x(t.tag,a);w(a)||_(a)||(b(a)?de(t,a,i):null!=i&&u&&fe(t,a,i,u))}if((t.flags&P)===P&&t.body.body(t),f(t.body)&&t.body.length>0)for(var s=n.firstChild,d=0,c=t.body[d];c.type===l?c=ve(c.view,c.data,c.key,c.opts)._redraw(t,d,!1).node:c.type===r&&(c=c.node||c._redraw(t,d,!1).node),"table"===t.tag&&"tr"===c.tag&&U("ATTACH_IMPLICIT_TBODY",[t,c]),e(c,s),(s=s.nextSibling)&&(c=t.body[++d]););}(this.node,e),this},Re.html=function(e){return null==this.node&&this._redraw(null,null,!1),We(this.node,e)},N.html=function(e){return We(this,e)},Oe.DEVMODE=Y,Oe});