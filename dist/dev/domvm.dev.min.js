// https://github.com/leeoniya/domvm (3.x-dev, dev build)
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.domvm=t()}(this,function(){"use strict";var T=1,s=2,N=3,D=4,R=5,e="undefined"!=typeof window,t=e?window:{},a=e?document:{},o=t.requestAnimationFrame,C={};function S(){}var y=Array.isArray;function i(e){return null!=e&&e.constructor===Object}function u(e){return"function"==typeof e}function d(e){for(var t=arguments,n=1;n<t.length;n++)for(var l in t[n])e[l]=t[n][l];return e}function f(e,t){for(var n=[],l=t;l<e.length;l++)n.push(e[l]);return n}function p(e,t){for(var n in e)if(e[n]!==t[n])return!1;return!0}function m(e,t){var n=e.length;if(t.length!==n)return!1;for(var l=0;l<n;l++)if(e[l]!==t[l])return!1;return!0}function l(e){if(!o)return e;var t,n,l;function r(){t=0,e.apply(n,l)}return function(){n=this,l=arguments,t||(t=o(r))}}function c(e){return"o"===e[0]&&"n"===e[1]}function v(e){return"_"===e[0]}function h(e){return"style"===e}function g(e){e&&e.el&&e.el.offsetHeight}function M(e){return null!=e.node&&null!=e.node.el}function b(e,t){switch(t){case"value":case"checked":case"selected":return!0}return!1}function _(e){for(e=e||C;null==e.vm&&e.parent;)e=e.parent;return e.vm}function w(){}var n=w.prototype={constructor:w,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null};function k(e){var t=new w;return t.type=s,t.body=e,t}var E=function(){return!1},r=S,x=S,A=S;function L(e,t){var n=x(e,function(e){n&&(null!=t.node&&t.redraw(),A(n))});return r(e)}function I(e,t){var n=x(e,function(e){n&&null!=t.node&&t.redraw()});return n}var O={},H=/\[(\w+)(?:=(\w+))?\]/g;var Y={warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(e,t,n){if(u(e.view)&&1<e.view.length){return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",e,t,n]}},UNKEYED_INPUT:function(e){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",e]},UNMOUNTED_REDRAW:function(e){return["Invoking redraw() of an unmounted (sub)view may result in errors.",e]},INLINE_HANDLER:function(e,t,n){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",e,t,n]},MISMATCHED_HANDLER:function(e,t,n){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",e,t,n]},SVG_WRONG_FACTORY:function(e){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",e]},FOREIGN_ELEMENT:function(e){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",e]},REUSED_ATTRS:function(e){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",e]},ADJACENT_TEXT:function(e,t,n){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",e,t,n]},ARRAY_FLATTENED:function(e,t){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",e,t]},ALREADY_HYDRATED:function(e){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",e]},ATTACH_IMPLICIT_TBODY:function(e,t){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",e,t]}};function U(e,t){if(Y.warnings&&u(Y[e])){var n=Y[e].apply(null,t);n&&(n[0]=e+": "+(Y.verbose?n[0]:""),console.warn.apply(console,n))}}var V=1,j=2,F=4,P=8;function G(e,t,n,l){var r=new w;r.type=T,r.flags=l||0,r.attrs=t||null;var o=function(e){var t,n,l,r,o=O[e];if(null==o)for(O[e]=o={tag:(t=e.match(/^[-\w]+/))?t[0]:"div",id:(n=e.match(/#([-\w]+)/))?n[1]:null,class:(l=e.match(/\.([-\w.]+)/))?l[1].replace(/\./g," "):null,attrs:null};r=H.exec(e);)null==o.attrs&&(o.attrs={}),o.attrs[r[1]]=r[2]||"";return o}(e);r.tag=o.tag;var a=null!=o.id,i=null!=o.class,u=null!=o.attrs;if(a||i||u){var s=r.attrs||{};if(a&&null==s.id&&(s.id=o.id),i&&(r._class=o.class,s.class=o.class+(null!=s.class?" "+s.class:"")),u)for(var d in o.attrs)null==s[d]&&(s[d]=o.attrs[d]);r.attrs=s}var f=r.attrs;return null!=f&&(null!=f._key&&(r.key=f._key),null!=f._ref&&(r.ref=f._ref),null!=f._hooks&&(r.hooks=f._hooks),null!=f._data&&(r.data=f._data),null!=f._flags&&(r.flags=f._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=f.id?r.key=f.id:null!=f.name&&(r.key=f.name+("radio"===f.type||"checkbox"===f.type?f.value:"")))),null!=n&&(r.body=n),"svg"===r.tag?setTimeout(function(){null==r.ns&&U("SVG_WRONG_FACTORY",[r])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(r.tag)&&null==r.key&&U("UNKEYED_INPUT",[r]),r}function W(e,t,n,l){if(e.type!==R&&e.type!==D){var r,o,a;e.parent=t,e.idx=n,e.vm=l,null!=e.ref&&(r=_(e),o=e.ref,a=e,function(e,t,n){for(var l;l=t.shift();)0===t.length?e[l]=n:e[l]=e=e[l]||{}}(r,("refs."+o).split("."),a));var i=e.hooks,u=l&&l.hooks;(i&&(i.willRemove||i.didRemove)||u&&(u.willUnmount||u.didUnmount))&&function(e){for(;e=e.parent;)e.flags|=V}(e),y(e.body)?function(e){for(var t=e.body,n=0;n<t.length;n++){var l=t[n];!1===l||null==l?t.splice(n--,1):y(l)?(0!==n&&n!==t.length-1||U("ARRAY_FLATTENED",[e,l]),o=l,a=n--,i=1,(r=t).splice.apply(r,[a,i].concat(o))):(null==l.type&&(t[n]=l=k(""+l)),l.type===s?null==l.body||""===l.body?t.splice(n--,1):0<n&&t[n-1].type===s?(U("ADJACENT_TEXT",[e,t[n-1].body,l.body]),t[n-1].body+=l.body,t.splice(n--,1)):W(l,e,n,null):W(l,e,n,null))}var r,o,a,i}(e):""===e.body?e.body=null:E(e.body)&&(e.body=L(e.body,_(e)))}}var z={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function B(e,t){return isNaN(t)||z[e]?t:t+"px"}function K(e,t){var n,l=(e.attrs||C).style,r=t?(t.attrs||C).style:null;if(null==l||("string"===(n=typeof l)||"number"===n))e.el.style.cssText=l;else{for(var o in l){var a=l[o];E(a)&&(l[o]=a=L(a,_(e))),(null==r||null!=a&&a!==r[o])&&(e.el.style[o]=B(o,a))}if(r)for(var i in r)null==l[i]&&(e.el.style[i]="")}}var X=[];function $(e,t,n,l,r){if(null!=e){var o=n.hooks[t];if(o){if("d"!==t[0]||"i"!==t[1]||"d"!==t[2])return o(n,l);r?g(n.parent)&&o(n,l):X.push([o,n,l])}}}function q(e){var t;if(X.length)for(g(e.node);t=X.shift();)t[0](t[1],t[2])}function J(e){return e.nextSibling}function Z(e,t,n){var l=t._node,r=l.vm;if(y(l.body))if((l.flags&V)===V)for(var o=0;o<l.body.length;o++)Z(t,l.body[o].el);else ee(l);delete t._node,e.removeChild(t),$(l.hooks,"didRemove",l,null,n),null!=r&&($(r.hooks,"didUnmount",r,r.data,n),r.node=null)}function Q(e,t){var n=t._node;if(!n._dead){var l,r,o,a,i=function e(t){var n=t.vm,l=null!=n&&$(n.hooks,"willUnmount",n,n.data),r=$(t.hooks,"willRemove",t);if((t.flags&V)===V&&y(t.body))for(var o=0;o<t.body.length;o++)e(t.body[o]);return l||r}(n);null!=i&&("object"==typeof(a=i)&&u(a.then))?(n._dead=!0,i.then((l=Z,r=[e,t,!0],function(){return l.apply(o,r)}))):Z(e,t)}}function ee(e){for(var t=e.body,n=0;n<t.length;n++){var l=t[n];delete l.el._node,null!=l.vm&&(l.vm.node=null),y(l.body)&&ee(l)}}function te(e){var t=e.el;if(0==(e.flags&V))y(e.body)&&ee(e),t.textContent=null;else{var n=t.firstChild;do{var l=J(n);Q(t,n)}while(n=l)}}function ne(e,t,n){var l=t._node,r=null!=t.parentNode,o=t!==n&&r?null:l.vm;null!=o&&$(o.hooks,"willMount",o,o.data),$(l.hooks,r?"willReinsert":"willInsert",l),e.insertBefore(t,n),$(l.hooks,r?"didReinsert":"didInsert",l),null!=o&&$(o.hooks,"didMount",o,o.data)}function le(e,t,n){ne(e,t,n?J(n):null)}var re={};var oe=S,ae=!1;function ie(e,t,n){e[t]=n}function ue(e,t,n,l,r){var o=e.apply(r,t.concat([n,l,r,r.data]));r.onevent(n,l,r,r.data,t),oe.call(null,n,l,r,r.data,t),!1===o&&(n.preventDefault(),n.stopPropagation())}function se(e){var t,n,l=function(e){for(;null==e._node;)e=e.parentNode;return e._node}(e.target),r=_(l),o=e.currentTarget._node.attrs["on"+e.type];if(y(o))ue(t=o[0],n=o.slice(1),e,l,r);else for(var a in o)if(e.target.matches(a)){var i=o[a];y(i)?(t=i[0],n=i.slice(1)):(t=i,n=[]),ue(t,n,e,l,r)}}function de(e,t,n,l){if(n!==l){u(n)&&u(l)&&l.name==n.name&&U("INLINE_HANDLER",[e,l,n]),null==l||null==n||y(l)==y(n)&&i(l)==i(n)&&u(l)==u(n)||U("MISMATCHED_HANDLER",[e,l,n]);var r=e.el;null==n||u(n)?ie(r,t,n):null==l&&ie(r,t,se)}}function fe(e,t,n,l,r){var o=e.el;null!=e.ns?o.setAttribute(t,n):"class"===t?o.className=n:"id"===t||"boolean"==typeof n||l?o[t]=n:"."===t[0]?o[t.substr(1)]=n:o.setAttribute(t,n)}function ce(e,t,n){var l,r,o,a=e.attrs||C,i=t.attrs||C;if(a===i)U("REUSED_ATTRS",[e]);else{for(var u in a){var s=a[u];if(null!=s){var d=b(e.tag,u),f=d?e.el[u]:i[u];E(s)&&(a[u]=s=L(s,_(e))),s===f||(h(u)?K(e,t):v(u)||(c(u)?de(e,u,s,f):fe(e,u,s,d)))}}for(var u in i)null==a[u]&&!v(u)&&(r=u,o=b((l=e).tag,u)||c(u),"."===r[0]&&(r=r.substr(1),o=!0),o?l.el[r]="":l.el.removeAttribute(r))}}function ve(e,t,n,l){return e.type===D&&(t=e.data,n=e.key,l=e.opts,e=e.view),new De(e,t,n,l)}function ye(e){for(var t=0;t<e.body.length;t++){var n=e.body[t],l=n.type;if(l<=N)ne(e.el,pe(n));else if(l===D){l=(r=ve(n.view,n.data,n.key,n.opts)._redraw(e,t,!1)).node.type,ne(e.el,pe(r.node))}else if(l===R){var r;(r=n.vm)._redraw(e,t),l=r.node.type,ne(e.el,r.node.el)}}}function pe(e,t){var n,l,r,o;return null==e.el&&(e.type===T?(e.el=t||(r=e.tag,null!=(o=e.ns)?a.createElementNS(o,r):a.createElement(r)),null!=e.attrs&&ce(e,C),(e.flags&P)===P&&e.body.body(e),y(e.body)?ye(e):null!=e.body&&(e.el.textContent=e.body)):e.type===s?e.el=t||(l=e.body,a.createTextNode(l)):e.type===N&&(e.el=t||(n=e.body,a.createComment(n)))),(e.el._node=e).el}var me=1,he=2;function ge(u,s,d,f,c,v,y,p){return function(e,t,n,l,r,o){var a,i;if(null!=l[f]){if(null==(a=l[f]._node))return U("FOREIGN_ELEMENT",[l[f]]),void(l[f]=u(l[f]));if(a.parent!==e)return i=u(l[f]),null!=a.vm?a.vm.unmount(!0):Q(t,l[f]),void(l[f]=i)}if(l[c]==r)return he;if(null==l[c].el)d(t,pe(l[c]),l[f]),l[c]=s(l[c],n);else if(l[c].el===l[f])l[c]=s(l[c],n),l[f]=u(l[f]);else{if(o||a!==l[y])return null!=l[c].vm&&U("ALREADY_HYDRATED",[l[c].vm]),o&&null!=l[f]?function(e,t,n,l,r,o,a,i,u){if(i._lis)n(o,u[r].el,u[l]),u[r]=t(u[r],a);else{var s=function(e,t){var n,l=0,r=t.length-1;if(r<=2147483647)for(;l<=r;){if(t[n=l+r>>1]===e)return n;t[n]<e?l=n+1:r=n-1}else for(;l<=r;){if(t[n=Math.floor((l+r)/2)]===e)return n;t[n]<e?l=n+1:r=n-1}return l==t.length?null:l}(i.idx,u.tombs);i._lis=!0;var d=e(u[l]);n(o,u[l],null!=s?a[u.tombs[s]].el:s),null==s?u.tombs.push(i.idx):u.tombs.splice(s,0,i.idx),u[l]=d}}(u,s,d,f,c,t,n,a,l):me;i=l[f],l[f]=u(i),p(t,i,l[v]),l[v]=i}}}var be=ge(J,function(e,t){return t[e.idx+1]},ne,"lftSib","lftNode","rgtSib","rgtNode",le),_e=ge(function(e){return e.previousSibling},function(e,t){return t[e.idx-1]},le,"rgtSib","rgtNode","lftSib","lftNode",ne);function we(e,t,n,l){for(var r=[],o=r.slice.call(t.childNodes),a=0;a<o.length;a++){var i=o[a]._node;i.parent===e&&r.push(i.idx)}for(var u=function(e){var t,n,l=e.slice(),r=[];r.push(0);for(var o=0,a=e.length;o<a;++o){var i=r[r.length-1];if(e[i]<e[o])l[o]=i,r.push(o);else{for(t=0,n=r.length-1;t<n;){var u=(t+n)/2|0;e[r[u]]<e[o]?t=u+1:n=u}e[o]<e[r[t]]&&(0<t&&(l[o]=r[t-1]),r[t]=o)}}for(n=r[(t=r.length)-1];0<t--;)n=l[r[t]=n];return r}(r).map(function(e){return r[e]}),s=0;s<u.length;s++)n[u[s]]._lis=!0;for(l.tombs=u;;){if(be(e,t,n,l,null,!0)===he)break}}function ke(e){return e.el._node.parent!==e.parent}function Ee(e,t,n){return t[n]}function xe(e,t,n){for(;n<t.length;n++){var l=t[n];if(null!=l.vm){if(e.type===D&&l.vm.view===e.view&&l.vm.key===e.key||e.type===R&&l.vm===e.vm)return l}else if(!ke(l)&&e.tag===l.tag&&e.type===l.type&&e.key===l.key&&(e.flags&~V)==(l.flags&~V))return l}return null}function Ae(e,t,n){if(null==t._keys){if(t[n].key===e.key)return t[n];for(var l={},r=0;r<t.length;r++)l[t[r].key]=r;t._keys=l}return t[t._keys[e.key]]}function Te(e,t){$(t.hooks,"willRecycle",t,e);var n=e.el=t.el,l=t.body,r=e.body;if((n._node=e).type!==s||r===l){null==e.attrs&&null==t.attrs||ce(e,t);var o=y(l),a=y(r),i=(e.flags&P)===P;o?a||i?function(e,t){var n=e.body,l=n.length,r=t.body,o=r.length,a=(e.flags&P)===P,i=(e.flags&j)===j,u=(e.flags&F)===F,s=!i&&e.type===T,d=!0,f=0===o?S:u?Ae:i||a?Ee:xe;if(s&&0===l)return te(t),a&&(e.body=[]);var c,v,y=0,p=!1,m=0;if(a)var h={key:null},g=Array(l);for(var b=0;b<l;b++){if(a){var _=!1,w=null;d&&(u&&(h.key=n.key(b)),c=f(h,r,m)),null!=c?(v=c.idx,!0===(w=n.diff(b,c))?((k=c).parent=e,k.idx=b,k._lis=!1):_=!0):_=!0,_&&(W(k=n.tpl(b),e,b),k._diff=null!=w?w:n.diff(b),null!=c&&Te(k,c)),g[b]=k}else{var k=n[b],E=k.type;if(E<=N)(c=d&&f(k,r,m))&&(Te(k,c),v=c.idx);else if(E===D){if(c=d&&f(k,r,m)){v=c.idx;var x=c.vm._update(k.data,e,b)}else var x=ve(k.view,k.data,k.key,k.opts)._redraw(e,b,!1);E=x.node.type}else if(E===R){var A=M(k.vm),x=k.vm._update(k.data,e,b,A);E=x.node.type}}if(null!=c&&(v===m?++m===o&&o<l&&(c=null,d=!1):p=!0,!u&&100<o&&p&&++y%10==0))for(;m<o&&ke(r[m]);)m++}a&&(e.body=g);s&&function(e,t){var n=t.body,l=e.el,r=e.body,o={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(n[0]||C).el,rgtSib:(n[n.length-1]||C).el};e:for(;;){for(;;){var a=be(e,l,r,o,null,!1);if(a===me)break;if(a===he)break e}for(;;){var i=_e(e,l,r,o,o.lftNode,!1);if(i===me)break;if(i===he)break e}we(e,l,r,o);break}}(e,t)}(e,t):r!==l&&(null!=r?n.textContent=r:te(t)):a?(te(t),ye(e)):r!==l&&(null!=r&&null!=l?n.firstChild.nodeValue=r:n.textContent=r),$(t.hooks,"didRecycle",t,e)}else n.nodeValue=r}var Ne=null;function De(e,t,n,l){var r=this;r.view=e,r.data=t,r.key=n,E(t)&&(r._stream=I(t,r)),l&&(r.opts=l,r.config(l));var o=i(e)?e:e.call(r,r,t,n,l);u(o)?r.render=o:(r.render=o.render,r.config(o)),r.init&&r.init.call(r,r,r.data,r.key,l)}Y.mutations&&(Ne=new function(l){navigator.userAgent.indexOf("Edge");var e=-1!==navigator.userAgent.indexOf("Trident/"),t=Object.getOwnPropertyDescriptor,n=Object.defineProperty,r=Node.prototype,o=t(r,"textContent"),a=t(r,"nodeValue"),i=HTMLElement.prototype,u=t(i,"innerText"),s=Element.prototype,d=t(e?i:s,"innerHTML"),f=t(e?i:s,"className"),c=t(e?i:s,"id"),v=CSSStyleDeclaration.prototype,y=t(v,"cssText"),p=HTMLInputElement.prototype,m=HTMLTextAreaElement.prototype,h=HTMLSelectElement.prototype,g=HTMLOptionElement.prototype,b=t(p,"checked"),_=t(p,"value"),w=t(m,"value"),k=t(h,"value"),E=t(h,"selectedIndex"),x=t(g,"selected"),A={"document.createElement":null,"document.createElementNS":null,"document.createTextNode":null,"document.createComment":null,"document.createDocumentFragment":null,"DocumentFragment.prototype.insertBefore":null,"Element.prototype.appendChild":null,"Element.prototype.removeChild":null,"Element.prototype.insertBefore":null,"Element.prototype.replaceChild":null,"Element.prototype.remove":null,"Element.prototype.setAttribute":null,"Element.prototype.setAttributeNS":null,"Element.prototype.removeAttribute":null,"Element.prototype.removeAttributeNS":null},T={},N=null;function D(e){for(var t=e.split("."),n=window;1<t.length;)n=n[t.shift()];return{ctx:n,last:t[0]}}for(var R in A){var C=D(R);null===A[R]&&(A[R]=C.ctx[C.last]),function(e,t){T[t]=0,C.ctx[t]=function(){return T[t]++,A[e].apply(this,arguments)}}(R,C.last)}T.textContent=0,n(r,"textContent",{set:function(e){T.textContent++,o.set.call(this,e)}}),T.nodeValue=0,n(r,"nodeValue",{set:function(e){T.nodeValue++,a.set.call(this,e)}}),T.innerText=0,n(i,"innerText",{set:function(e){T.innerText++,u.set.call(this,e)}}),T.innerHTML=0,n(e?i:s,"innerHTML",{set:function(e){T.innerHTML++,d.set.call(this,e)}}),T.className=0,n(e?i:s,"className",{set:function(e){T.className++,f.set.call(this,e)}}),T.cssText=0,n(v,"cssText",{set:function(e){T.cssText++,y.set.call(this,e)}}),T.id=0,n(e?i:s,"id",{set:function(e){T.id++,c.set.call(this,e)}}),T.checked=0,n(p,"checked",{set:function(e){T.checked++,b.set.call(this,e)}}),T.value=0,n(p,"value",{set:function(e){T.value++,_.set.call(this,e)}}),n(m,"value",{set:function(e){T.value++,w.set.call(this,e)}}),n(h,"value",{set:function(e){T.value++,k.set.call(this,e)}}),T.selectedIndex=0,n(h,"selectedIndex",{set:function(e){T.selectedIndex++,E.set.call(this,e)}}),T.selected=0,n(g,"selected",{set:function(e){T.selected++,x.set.call(this,e)}}),this.start=function(){N=+new Date},this.end=function(){var e=+new Date-N;N=null;var t={};for(var n in T)0<T[n]&&(t[n]=T[n]);return function(){for(var e in T)T[e]=0}(),l&&(t._time=e),t}}(!0));var Re=De.prototype={constructor:De,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:S,refs:null,render:null,mount:function(e,t){var n=this;Y.mutations&&Ne.start();t?(te({el:e,flags:0}),n._redraw(null,null,!1),e.nodeName.toLowerCase()!==n.node.tag?(pe(n.node),ne(e.parentNode,n.node.el,e),e.parentNode.removeChild(e)):ne(e.parentNode,pe(n.node,e),e)):(n._redraw(null,null),e&&ne(e,n.node.el));e&&q(n);Y.mutations&&console.log(Ne.end());return n},unmount:function(e){E(this._stream)&&A(this._stream);var t=this.node;Q(t.el.parentNode,t.el),e||q(this)},config:function(e){var t=this;e.init&&(t.init=e.init),e.diff&&(t.diff=e.diff),e.onevent&&(t.onevent=e.onevent),e.hooks&&(t.hooks=d(t.hooks||{},e.hooks)),e.onemit&&(t.onemit=d(t.onemit||{},e.onemit))},parent:function(){return _(this.node.parent)},root:function(){for(var e=this.node;e.parent;)e=e.parent;return e.vm},redraw:function(e){null==e&&(e=ae);var t=this;return e?t._redraw(null,null,M(t)):(t._redrawAsync=t._redrawAsync||l(function(e){return t.redraw(!0)}))(),t},update:function(e,t){null==t&&(t=ae);var n=this;return t?n._update(e,null,null,M(n)):(n._updateAsync=n._updateAsync||l(function(e){return n.update(e,!0)}))(e),n},_update:function(e,t,n,l){var r=this;null!=e&&r.data!==e&&(U("DATA_REPLACED",[r,r.data,e]),$(r.hooks,"willUpdate",r,e),r.data=e,E(r._stream)&&A(r._stream),E(e)&&(r._stream=I(e,r)));return r._redraw(t,n,l)},_redraw:function(e,t,n){var l=null==e,r=this,o=r.node&&r.node.el&&r.node.el.parentNode;l&&r.node&&r.node.el&&!r.node.el.parentNode&&U("UNMOUNTED_REDRAW",[r]);l&&Y.mutations&&o&&Ne.start();var a,i,u=r.node;if(null!=r.diff&&(a=r._diff,r._diff=i=r.diff(r,r.data),null!=u)){var s=y(a)?m:p,d=a===i||s(a,i);if(d)return Ce(r,u,e,t)}o&&$(r.hooks,"willRedraw",r,r.data);var f=r.render.call(r,r,r.data,a,i);if(f===u)return Ce(r,u,e,t);(r.refs=null)!=r.key&&f.key!==r.key&&(f.key=r.key);r.node=f,e?(W(f,e,t,r),e.body[t]=f):u&&u.parent?(W(f,u.parent,u.idx,r),u.parent.body[u.idx]=f):W(f,null,null,r);if(!1!==n)if(u)if(u.tag!==f.tag||u.key!==f.key){u.vm=f.vm=null;var c=u.el.parentNode,v=J(u.el);Q(c,u.el),ne(c,pe(f),v),u.el=f.el,f.vm=r}else Te(f,u);else pe(f);o&&$(r.hooks,"didRedraw",r,r.data),l&&o&&q(r);l&&Y.mutations&&o&&console.log(Ne.end());return r},_redrawAsync:null,_updateAsync:null};function Ce(e,t,n,l){return null!=n&&((n.body[l]=t).idx=l,t.parent=n,t._lis=!1),e}function Se(e,t,n,l){var r,o;return null==n?i(t)?r=t:o=t:(r=t,o=n),G(e,r,o,l)}var Me="http://www.w3.org/2000/svg";function Le(e,t,n,l){this.view=e,this.data=t,this.key=n,this.opts=l}function Ie(e){this.vm=e}Le.prototype={constructor:Le,type:D,view:null,data:null,key:null,opts:null},Ie.prototype={constructor:Ie,type:R,vm:null};var Oe={config:function(e){var t,n;oe=e.onevent||oe,null!=e.syncRedraw&&(ae=e.syncRedraw),e.onemit&&(t=e.onemit,d(re,t)),e.stream&&(n=e.stream,E=n.is,r=n.val,x=n.sub,A=n.unsub)},ViewModel:De,VNode:w,createView:ve,defineElement:Se,defineSvgElement:function(e,t,n,l){var r=Se(e,t,n,l);return r.ns=Me,r},defineText:k,defineComment:function(e){var t=new w;return t.type=N,t.body=e,t},defineView:function(e,t,n,l){return new Le(e,t,n,l)},injectView:function(e){return new Ie(e)},injectElement:function(e){var t=new w;return t.type=T,t.el=t.key=e,t},lazyList:function(r,o){var a=r.length,i={items:r,length:a,key:function(e){return o.key(r[e],e)},diff:function(e,t){var n=o.diff(r[e],e);if(null==t)return n;var l=t._diff;return(n===l||y(l)?m(n,l):p(n,l))||n},tpl:function(e){return o.tpl(r[e],e)},map:function(e){return o.tpl=e,i},body:function(e){for(var t=Array(a),n=0;n<a;n++){var l=i.tpl(n);l._diff=i.diff(n),W(t[n]=l,e,n)}e.body=t}};return i},FIXED_BODY:j,DEEP_REMOVE:V,KEYED_LIST:F,LAZY_LIST:P};function He(e){var t,n,l=arguments,r=l.length;if(1<r){var o=1;i(l[1])&&(n=l[1],o=2),t=r!==o+1||l[o]instanceof w||l[o]instanceof Le||l[o]instanceof Ie?f(l,o):l[o]}return G(e,n,t)}function Ye(e){var t="";for(var n in e)null!=e[n]&&(t+=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+": "+B(n,e[n])+"; ");return t}function Ue(e){return null==e?"":""+e}n.patch=function(e,t){!function(e,t,n){if(null!=t.type){if(null!=e.vm)return;W(t,e.parent,e.idx,null),Te(e.parent.body[e.idx]=t,e),n&&g(t),q(_(t))}else{var l=Object.create(e);l.attrs=d({},e.attrs);var r=d(e.attrs,t);if(null!=e._class){var o=r.class;r.class=null!=o&&""!==o?e._class+" "+o:e._class}ce(e,l),n&&g(e)}}(this,e,t)},Re.emit=function(e){var t=this,n=t,l=f(arguments,1).concat(n,n.data);do{var r=t.onemit,o=r?r[e]:null;if(o){o.apply(t,l);break}}while(t=t.parent());re[e]&&re[e].apply(t,l)},Re.onemit=null,Re.body=function(){return function e(t,n){var l=t.body;if(y(l))for(var r=0;r<l.length;r++){var o=l[r];null!=o.vm?n.push(o.vm):e(o,n)}return n}(this.node,[])},Oe.defineElementSpread=He,Oe.defineSvgElementSpread=function(){var e=He.apply(null,arguments);return e.ns=Me,e},Re._stream=null;var Ve={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function je(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)switch(e[t]){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=e[t]}return n}function Fe(e){e=Ue(e);for(var t=0,n="";t<e.length;t++)n+='"'===e[t]?"&quot;":e[t];return n}function Pe(e,t){for(var n="",l=0;l<e.length;l++)n+=We(e[l],t);return n}var Ge=".innerHTML";function We(e,t){var n,l;switch(e.type){case D:n=ve(e.view,e.data,e.key,e.opts).html(t);break;case R:n=e.vm.html();break;case T:if(null!=e.el&&null==e.tag){n=e.el.outerHTML;break}var r="";r+="<"+e.tag;var o=e.attrs,a=null!=o;if(a){for(var i in o)if(!(c(i)||"."===i[0]||"_"===i[0]||!1===t&&b(e.tag,i))){var u=o[i];"style"!==i||null==u?!0===u?r+=" "+je(i)+'=""':!1===u||null!=u&&(r+=" "+je(i)+'="'+Fe(u)+'"'):l="object"==typeof u?Ye(u):u}null!=l&&(r+=' style="'+Fe(l.trim())+'"')}if(null==e.body&&null!=e.ns&&"svg"!==e.tag)return r+"/>";r+=">",Ve[e.tag]||(a&&null!=o[Ge]?r+=o[Ge]:y(e.body)?r+=Pe(e.body,t):(e.flags&P)===P?(e.body.body(e),r+=Pe(e.body,t)):r+=je(e.body),r+="</"+e.tag+">"),n=r;break;case s:n=je(e.body);break;case N:n="\x3c!--"+je(e.body)+"--\x3e"}return n}return Re.attach=function(e){return null==this.node&&this._redraw(null,null,!1),function e(t,n){var l=((t.el=n)._node=t).attrs;for(var r in l){var o=l[r],a=b(t.tag,r);h(r)||v(r)||(c(r)?de(t,r,o):null!=o&&a&&fe(t,r,o,a))}if((t.flags&P)===P&&t.body.body(t),y(t.body)&&0<t.body.length)for(var i=n.firstChild,u=0,s=t.body[u];s.type===D?s=ve(s.view,s.data,s.key,s.opts)._redraw(t,u,!1).node:s.type===R&&(s=s.node||s._redraw(t,u,!1).node),"table"===t.tag&&"tr"===s.tag&&U("ATTACH_IMPLICIT_TBODY",[t,s]),e(s,i),(i=i.nextSibling)&&(s=t.body[++u]););}(this.node,e),this},Re.html=function(e){return null==this.node&&this._redraw(null,null,!1),We(this.node,e)},n.html=function(e){return We(this,e)},Oe.DEVMODE=Y,Oe});