// https://github.com/leeoniya/domvm (3.x-dev, pico build)
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.domvm=e()}(this,function(){"use strict";var R=1,f=2,E=3,S=4,C=5,n="undefined"!=typeof window,e=n?window:{},u=n?document:{},o=e.requestAnimationFrame,V={};function T(){}var y=Array.isArray;function i(n){return null!=n&&n.constructor===Object}function a(n){return"function"==typeof n}function p(n,e){for(var t in n)if(n[t]!==e[t])return!1;return!0}function h(n,e){var t=n.length;if(e.length!==t)return!1;for(var l=0;l<t;l++)if(n[l]!==e[l])return!1;return!0}function l(n){if(!o)return n;var e,t,l;function r(){e=0,n.apply(t,l)}return function(){t=this,l=arguments,e||(e=o(r))}}function g(n){return"o"===n[0]&&"n"===n[1]}function b(n){return"_"===n[0]}function d(n){n&&n.el&&n.el.offsetHeight}function j(n){return null!=n.node&&null!=n.node.el}function k(n,e){switch(e){case"value":case"checked":case"selected":return!0}return!1}function s(n){for(n=n||V;null==n.vm&&n.parent;)n=n.parent;return n.vm}function v(){}v.prototype={constructor:v,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null};function c(n){var e=new v;return e.type=f,e.body=n,e}var m={};var _=1,D=2,I=4,L=8;function w(n,e,t,l){var r=new v;r.type=R,r.flags=l||0,r.attrs=e||null;var o,u=(o=n,m.tag=o,m);r.tag=u.tag;var i=null!=u.id,a=null!=u.class,f=null!=u.attrs;if(i||a||f){var d=r.attrs||{};if(i&&null==d.id&&(d.id=u.id),a&&(r._class=u.class,d.class=u.class+(null!=d.class?" "+d.class:"")),f)for(var s in u.attrs)null==d[s]&&(d[s]=u.attrs[s]);r.attrs=d}var c=r.attrs;return null!=c&&(null!=c._key&&(r.key=c._key),null!=c._ref&&(r.ref=c._ref),null!=c._hooks&&(r.hooks=c._hooks),null!=c._data&&(r.data=c._data),null!=c._flags&&(r.flags=c._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=c.id?r.key=c.id:null!=c.name&&(r.key=c.name+("radio"===c.type||"checkbox"===c.type?c.value:"")))),null!=t&&(r.body=t),r}function M(n,e,t,l){if(n.type!==C&&n.type!==S){var r,o,u;n.parent=e,n.idx=t,n.vm=l,null!=n.ref&&(r=s(n),o=n.ref,u=n,function(n,e,t){for(var l;l=e.shift();)0===e.length?n[l]=t:n[l]=n=n[l]||{}}(r,("refs."+o).split("."),u));var i=n.hooks,a=l&&l.hooks;(i&&(i.willRemove||i.didRemove)||a&&(a.willUnmount||a.didUnmount))&&function(n){for(;n=n.parent;)n.flags|=_}(n),y(n.body)?function(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];!1===l||null==l?e.splice(t--,1):y(l)?(o=l,u=t--,i=1,(r=e).splice.apply(r,[u,i].concat(o))):(null==l.type&&(e[t]=l=c(""+l)),l.type===f?null==l.body||""===l.body?e.splice(t--,1):0<t&&e[t-1].type===f?(e[t-1].body+=l.body,e.splice(t--,1)):M(l,n,t,null):M(l,n,t,null))}var r,o,u,i}(n):""===n.body&&(n.body=null)}}function x(n,e){var t,l=(n.attrs||V).style,r=e?(e.attrs||V).style:null;if(null==l||("string"===(t=typeof l)||"number"===t))n.el.style.cssText=l;else{for(var o in l){var u=l[o];(null==r||null!=u&&u!==r[o])&&(n.el.style[o]=u)}if(r)for(var i in r)null==l[i]&&(n.el.style[i]="")}}var N=[];function A(n,e,t,l,r){if(null!=n){var o=t.hooks[e];if(o){if("d"!==e[0]||"i"!==e[1]||"d"!==e[2])return o(t,l);r?d(t.parent)&&o(t,l):N.push([o,t,l])}}}function U(n){var e;if(N.length)for(d(n.node);e=N.shift();)e[0](e[1],e[2])}function O(n){return n.nextSibling}function Y(n,e,t){var l=e._node,r=l.vm;if(y(l.body))if((l.flags&_)===_)for(var o=0;o<l.body.length;o++)Y(e,l.body[o].el);else F(l);delete e._node,n.removeChild(e),A(l.hooks,"didRemove",l,null,t),null!=r&&(A(r.hooks,"didUnmount",r,r.data,t),r.node=null)}function B(n,e){var t=e._node;if(!t._dead){var l,r,o,u,i=function n(e){var t=e.vm,l=null!=t&&A(t.hooks,"willUnmount",t,t.data),r=A(e.hooks,"willRemove",e);if((e.flags&_)===_&&y(e.body))for(var o=0;o<e.body.length;o++)n(e.body[o]);return l||r}(t);null!=i&&("object"==typeof(u=i)&&a(u.then))?(t._dead=!0,i.then((l=Y,r=[n,e,!0],function(){return l.apply(o,r)}))):Y(n,e)}}function F(n){for(var e=n.body,t=0;t<e.length;t++){var l=e[t];delete l.el._node,null!=l.vm&&(l.vm.node=null),y(l.body)&&F(l)}}function P(n){var e=n.el;if(0==(n.flags&_))y(n.body)&&F(n),e.textContent=null;else{var t=e.firstChild;do{var l=O(t);B(e,t)}while(t=l)}}function q(n,e,t){var l=e._node,r=null!=e.parentNode,o=e!==t&&r?null:l.vm;null!=o&&A(o.hooks,"willMount",o,o.data),A(l.hooks,r?"willReinsert":"willInsert",l),n.insertBefore(e,t),A(l.hooks,r?"didReinsert":"didInsert",l),null!=o&&A(o.hooks,"didMount",o,o.data)}function t(n,e,t){q(n,e,t?O(t):null)}var z=T,r=!1;function H(n,e,t){n[e]=t}function K(n,e,t,l,r){var o=n.apply(r,e.concat([t,l,r,r.data]));r.onevent(t,l,r,r.data,e),z.call(null,t,l,r,r.data,e),!1===o&&(t.preventDefault(),t.stopPropagation())}function X(n){var e,t,l=function(n){for(;null==n._node;)n=n.parentNode;return n._node}(n.target),r=s(l),o=n.currentTarget._node.attrs["on"+n.type];if(y(o))K(e=o[0],t=o.slice(1),n,l,r);else for(var u in o)if(n.target.matches(u)){var i=o[u];y(i)?(e=i[0],t=i.slice(1)):(e=i,t=[]),K(e,t,n,l,r)}}function Z(n,e,t,l){if(t!==l){var r=n.el;null==t||a(t)?H(r,e,t):null==l&&H(r,e,X)}}function G(n,e,t){var l,r,o,u,i,a,f,d,s=n.attrs||V,c=e.attrs||V;if(s===c);else{for(var v in s){var y=s[v];if(null!=y){var p=k(n.tag,v),h=p?n.el[v]:c[v];y===h||("style"===v?x(n,e):b(v)||(g(v)?Z(n,v,y,h):(i=v,a=y,f=p,d=void 0,d=(u=n).el,null!=u.ns?d.setAttribute(i,a):"class"===i?d.className=a:"id"===i||"boolean"==typeof a||f?d[i]=a:"."===i[0]?d[i.substr(1)]=a:d.setAttribute(i,a))))}}for(var v in c)null==s[v]&&!b(v)&&(r=v,o=k((l=n).tag,v)||g(v),"."===r[0]&&(r=r.substr(1),o=!0),o?l.el[r]="":l.el.removeAttribute(r))}}function J(n,e,t,l){return n.type===S&&(e=n.data,t=n.key,l=n.opts,n=n.view),new sn(n,e,t,l)}function Q(n){for(var e=0;e<n.body.length;e++){var t=n.body[e],l=t.type;if(l<=E)q(n.el,W(t));else if(l===S){l=(r=J(t.view,t.data,t.key,t.opts)._redraw(n,e,!1)).node.type,q(n.el,W(r.node))}else if(l===C){var r;(r=t.vm)._redraw(n,e),l=r.node.type,q(n.el,r.node.el)}}}function W(n,e){var t,l,r,o;return null==n.el&&(n.type===R?(n.el=e||(r=n.tag,null!=(o=n.ns)?u.createElementNS(o,r):u.createElement(r)),null!=n.attrs&&G(n,V),(n.flags&L)===L&&n.body.body(n),y(n.body)?Q(n):null!=n.body&&(n.el.textContent=n.body)):n.type===f?n.el=e||(l=n.body,u.createTextNode(l)):n.type===E&&(n.el=e||(t=n.body,u.createComment(t)))),(n.el._node=n).el}var $=1,nn=2;function en(a,f,d,s,c,v,y,p){return function(n,e,t,l,r,o){var u,i;if(null!=l[s]){if(null==(u=l[s]._node))return void(l[s]=a(l[s]));if(u.parent!==n)return i=a(l[s]),null!=u.vm?u.vm.unmount(!0):B(e,l[s]),void(l[s]=i)}if(l[c]==r)return nn;if(null==l[c].el)d(e,W(l[c]),l[s]),l[c]=f(l[c],t);else if(l[c].el===l[s])l[c]=f(l[c],t),l[s]=a(l[s]);else{if(o||u!==l[y])return o&&null!=l[s]?function(n,e,t,l,r,o,u,i,a){if(i._lis)t(o,a[r].el,a[l]),a[r]=e(a[r],u);else{var f=function(n,e){var t,l=0,r=e.length-1;if(r<=2147483647)for(;l<=r;){if(e[t=l+r>>1]===n)return t;e[t]<n?l=t+1:r=t-1}else for(;l<=r;){if(e[t=Math.floor((l+r)/2)]===n)return t;e[t]<n?l=t+1:r=t-1}return l==e.length?null:l}(i.idx,a.tombs);i._lis=!0;var d=n(a[l]);t(o,a[l],null!=f?u[a.tombs[f]].el:f),null==f?a.tombs.push(i.idx):a.tombs.splice(f,0,i.idx),a[l]=d}}(a,f,d,s,c,e,t,u,l):$;i=l[s],l[s]=a(i),p(e,i,l[v]),l[v]=i}}}var tn=en(O,function(n,e){return e[n.idx+1]},q,"lftSib","lftNode","rgtSib","rgtNode",t),ln=en(function(n){return n.previousSibling},function(n,e){return e[n.idx-1]},t,"rgtSib","rgtNode","lftSib","lftNode",q);function rn(n,e,t,l){for(var r=[],o=r.slice.call(e.childNodes),u=0;u<o.length;u++){var i=o[u]._node;i.parent===n&&r.push(i.idx)}for(var a=function(n){var e,t,l=n.slice(),r=[];r.push(0);for(var o=0,u=n.length;o<u;++o){var i=r[r.length-1];if(n[i]<n[o])l[o]=i,r.push(o);else{for(e=0,t=r.length-1;e<t;){var a=(e+t)/2|0;n[r[a]]<n[o]?e=a+1:t=a}n[o]<n[r[e]]&&(0<e&&(l[o]=r[e-1]),r[e]=o)}}for(t=r[(e=r.length)-1];0<e--;)t=l[r[e]=t];return r}(r).map(function(n){return r[n]}),f=0;f<a.length;f++)t[a[f]]._lis=!0;for(l.tombs=a;;){if(tn(n,e,t,l,null,!0)===nn)break}}function on(n){return n.el._node.parent!==n.parent}function un(n,e,t){return e[t]}function an(n,e,t){for(;t<e.length;t++){var l=e[t];if(null!=l.vm){if(n.type===S&&l.vm.view===n.view&&l.vm.key===n.key||n.type===C&&l.vm===n.vm)return l}else if(!on(l)&&n.tag===l.tag&&n.type===l.type&&n.key===l.key&&(n.flags&~_)==(l.flags&~_))return l}return null}function fn(n,e,t){if(null==e._keys){if(e[t].key===n.key)return e[t];for(var l={},r=0;r<e.length;r++)l[e[r].key]=r;e._keys=l}return e[e._keys[n.key]]}function dn(n,e){A(e.hooks,"willRecycle",e,n);var t=n.el=e.el,l=e.body,r=n.body;if((t._node=n).type!==f||r===l){null==n.attrs&&null==e.attrs||G(n,e);var o=y(l),u=y(r),i=(n.flags&L)===L;o?u||i?function(n,e){var t=n.body,l=t.length,r=e.body,o=r.length,u=(n.flags&L)===L,i=(n.flags&D)===D,a=(n.flags&I)===I,f=!i&&n.type===R,d=!0,s=0===o?T:a?fn:i||u?un:an;if(f&&0===l)return P(e),u&&(n.body=[]);var c,v,y=0,p=!1,h=0;if(u)var g={key:null},b=Array(l);for(var k=0;k<l;k++){if(u){var m=!1,_=null;d&&(a&&(g.key=t.key(k)),c=s(g,r,h)),null!=c?(v=c.idx,!0===(_=t.diff(k,c))?((w=c).parent=n,w.idx=k,w._lis=!1):m=!0):m=!0,m&&(M(w=t.tpl(k),n,k),w._diff=null!=_?_:t.diff(k),null!=c&&dn(w,c)),b[k]=w}else{var w=t[k],x=w.type;if(x<=E)(c=d&&s(w,r,h))&&(dn(w,c),v=c.idx);else if(x===S){if(c=d&&s(w,r,h)){v=c.idx;var N=c.vm._update(w.data,n,k)}else var N=J(w.view,w.data,w.key,w.opts)._redraw(n,k,!1);x=N.node.type}else if(x===C){var A=j(w.vm),N=w.vm._update(w.data,n,k,A);x=N.node.type}}if(null!=c&&(v===h?++h===o&&o<l&&(c=null,d=!1):p=!0,!a&&100<o&&p&&++y%10==0))for(;h<o&&on(r[h]);)h++}u&&(n.body=b);f&&function(n,e){var t=e.body,l=n.el,r=n.body,o={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(t[0]||V).el,rgtSib:(t[t.length-1]||V).el};n:for(;;){for(;;){var u=tn(n,l,r,o,null,!1);if(u===$)break;if(u===nn)break n}for(;;){var i=ln(n,l,r,o,o.lftNode,!1);if(i===$)break;if(i===nn)break n}rn(n,l,r,o);break}}(n,e)}(n,e):r!==l&&(null!=r?t.textContent=r:P(e)):u?(P(e),Q(n)):r!==l&&(null!=r&&null!=l?t.firstChild.nodeValue=r:t.textContent=r),A(e.hooks,"didRecycle",e,n)}else t.nodeValue=r}function sn(n,e,t,l){var r=this;r.view=n,r.data=e,r.key=t,l&&(r.opts=l,r.config(l));var o=i(n)?n:n.call(r,r,e,t,l);a(o)?r.render=o:(r.render=o.render,r.config(o)),r.init&&r.init.call(r,r,r.data,r.key,l)}sn.prototype={constructor:sn,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:T,refs:null,render:null,mount:function(n,e){var t=this;e?(P({el:n,flags:0}),t._redraw(null,null,!1),n.nodeName.toLowerCase()!==t.node.tag?(W(t.node),q(n.parentNode,t.node.el,n),n.parentNode.removeChild(n)):q(n.parentNode,W(t.node,n),n)):(t._redraw(null,null),n&&q(n,t.node.el));n&&U(t);return t},unmount:function(n){var e=this.node;B(e.el.parentNode,e.el),n||U(this)},config:function(n){var e=this;n.init&&(e.init=n.init),n.diff&&(e.diff=n.diff),n.onevent&&(e.onevent=n.onevent),n.hooks&&(e.hooks=function(n){for(var e=arguments,t=1;t<e.length;t++)for(var l in e[t])n[l]=e[t][l];return n}(e.hooks||{},n.hooks))},parent:function(){return s(this.node.parent)},root:function(){for(var n=this.node;n.parent;)n=n.parent;return n.vm},redraw:function(n){null==n&&(n=r);var e=this;return n?e._redraw(null,null,j(e)):(e._redrawAsync=e._redrawAsync||l(function(n){return e.redraw(!0)}))(),e},update:function(n,e){null==e&&(e=r);var t=this;return e?t._update(n,null,null,j(t)):(t._updateAsync=t._updateAsync||l(function(n){return t.update(n,!0)}))(n),t},_update:function(n,e,t,l){var r=this;null!=n&&r.data!==n&&(A(r.hooks,"willUpdate",r,n),r.data=n);return r._redraw(e,t,l)},_redraw:function(n,e,t){var l,r,o=null==n,u=this,i=u.node&&u.node.el&&u.node.el.parentNode,a=u.node;if(null!=u.diff&&(l=u._diff,u._diff=r=u.diff(u,u.data),null!=a)){var f=y(l)?h:p,d=l===r||f(l,r);if(d)return cn(u,a,n,e)}i&&A(u.hooks,"willRedraw",u,u.data);var s=u.render.call(u,u,u.data,l,r);if(s===a)return cn(u,a,n,e);(u.refs=null)!=u.key&&s.key!==u.key&&(s.key=u.key);u.node=s,n?(M(s,n,e,u),n.body[e]=s):a&&a.parent?(M(s,a.parent,a.idx,u),a.parent.body[a.idx]=s):M(s,null,null,u);if(!1!==t)if(a)if(a.tag!==s.tag||a.key!==s.key){a.vm=s.vm=null;var c=a.el.parentNode,v=O(a.el);B(c,a.el),q(c,W(s),v),a.el=s.el,s.vm=u}else dn(s,a);else W(s);i&&A(u.hooks,"didRedraw",u,u.data),o&&i&&U(u);return u},_redrawAsync:null,_updateAsync:null};function cn(n,e,t,l){return null!=t&&((t.body[l]=e).idx=l,e.parent=t,e._lis=!1),n}function vn(n,e,t,l){var r,o;return null==t?i(e)?r=e:o=e:(r=e,o=t),w(n,r,o,l)}var yn="http://www.w3.org/2000/svg";function pn(n,e,t,l){this.view=n,this.data=e,this.key=t,this.opts=l}function hn(n){this.vm=n}return pn.prototype={constructor:pn,type:S,view:null,data:null,key:null,opts:null},hn.prototype={constructor:hn,type:C,vm:null},{config:function(n){z=n.onevent||z,null!=n.syncRedraw&&(r=n.syncRedraw)},ViewModel:sn,VNode:v,createView:J,defineElement:vn,defineSvgElement:function(n,e,t,l){var r=vn(n,e,t,l);return r.ns=yn,r},defineText:c,defineComment:function(n){var e=new v;return e.type=E,e.body=n,e},defineView:function(n,e,t,l){return new pn(n,e,t,l)},injectView:function(n){return new hn(n)},injectElement:function(n){var e=new v;return e.type=R,e.el=e.key=n,e},lazyList:function(r,o){var u=r.length,i={items:r,length:u,key:function(n){return o.key(r[n],n)},diff:function(n,e){var t=o.diff(r[n],n);if(null==e)return t;var l=e._diff;return(t===l||y(l)?h(t,l):p(t,l))||t},tpl:function(n){return o.tpl(r[n],n)},map:function(n){return o.tpl=n,i},body:function(n){for(var e=Array(u),t=0;t<u;t++){var l=i.tpl(t);l._diff=i.diff(t),M(e[t]=l,n,t)}n.body=e}};return i},FIXED_BODY:D,DEEP_REMOVE:_,KEYED_LIST:I,LAZY_LIST:L}});