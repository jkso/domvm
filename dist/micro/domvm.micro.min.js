// https://github.com/leeoniya/domvm (3.x-dev, micro build)

!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.domvm=t()}(this,function(){"use strict";function n(){}function t(n){return null!=n&&n.constructor===Object}function e(n,t,e,l){n.splice.apply(n,[e,l].concat(t))}function l(n){return"function"==typeof n}function r(n){for(var t=arguments,e=1;e<t.length;e++)for(var l in t[e])n[l]=t[e][l];return n}function i(n,t){for(var e=[],l=t;l<n.length;l++)e.push(n[l]);return e}function o(n,t){for(var e in n)if(n[e]!==t[e])return!1;return!0}function u(n,t){var e=n.length;if(t.length!==e)return!1;for(var l=0;l<e;l++)if(n[l]!==t[l])return!1;return!0}function a(n){function t(){e=0,n.apply(l,r)}if(!dn)return n;var e,l,r;return function(){l=this,r=arguments,e||(e=dn(t))}}function f(n){return"o"===n[0]&&"n"===n[1]}function s(n){return"_"===n[0]}function d(n){return"style"===n}function c(n){n&&n.el&&n.el.offsetHeight}function v(n){return null!=n.node&&null!=n.node.el}function h(n,t){switch(t){case"value":case"checked":case"selected":return!0}return!1}function y(n){for(n=n||cn;null==n.vm&&n.parent;)n=n.parent;return n.vm}function p(){}function m(n){var t=new p;return t.type=ln,t.body=n,t}function g(n,t,e,l){var r=new p;r.type=en,r.flags=l||0,r.attrs=t||null;var i=function(n){var t=yn[n];if(null==t){var e,l,r,i;for(yn[n]=t={tag:(e=n.match(/^[-\w]+/))?e[0]:"div",id:(l=n.match(/#([-\w]+)/))?l[1]:null,class:(r=n.match(/\.([-\w.]+)/))?r[1].replace(/\./g," "):null,attrs:null};i=pn.exec(n);)null==t.attrs&&(t.attrs={}),t.attrs[i[1]]=i[2]||""}return t}(n);r.tag=i.tag;var o=null!=i.id,u=null!=i.class,a=null!=i.attrs;if(o||u||a){var f=r.attrs||{};if(o&&null==f.id&&(f.id=i.id),u&&(r._class=i.class,f.class=i.class+(null!=f.class?" "+f.class:"")),a)for(var s in i.attrs)null==f[s]&&(f[s]=i.attrs[s]);r.attrs=f}var d=r.attrs;return null!=d&&(null!=d._key&&(r.key=d._key),null!=d._ref&&(r.ref=d._ref),null!=d._hooks&&(r.hooks=d._hooks),null!=d._data&&(r.data=d._data),null!=d._flags&&(r.flags=d._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=d.id?r.key=d.id:null!=d.name&&(r.key=d.name+("radio"===d.type||"checkbox"===d.type?d.value:"")))),null!=e&&(r.body=e),r}function b(n,t,l,r){if(n.type!==un&&n.type!==on){n.parent=t,n.idx=l,n.vm=r,null!=n.ref&&function(n,t,e){!function(n,t,e){for(var l;l=t.shift();)0===t.length?n[l]=e:n[l]=n=n[l]||{}}(n,["refs"].concat(t.split(".")),e)}(y(n),n.ref,n);var i=n.hooks,o=r&&r.hooks;(i&&(i.willRemove||i.didRemove)||o&&(o.willUnmount||o.didUnmount))&&function(n){for(;n=n.parent;)n.flags|=mn}(n),vn(n.body)?function(n){for(var t=n.body,l=0;l<t.length;l++){var r=t[l];!1===r||null==r?t.splice(l--,1):vn(r)?e(t,r,l--,1):(null==r.type&&(t[l]=r=m(""+r)),r.type===ln?null==r.body||""===r.body?t.splice(l--,1):l>0&&t[l-1].type===ln?(t[l-1].body+=r.body,t.splice(l--,1)):b(r,n,l,null):b(r,n,l,null))}}(n):""===n.body&&(n.body=null)}}function k(n,t){return isNaN(t)||_n[n]?t:t+"px"}function _(n,t){var e=(n.attrs||cn).style,l=t?(t.attrs||cn).style:null;if(null==e||function(n){var t=typeof n;return"string"===t||"number"===t}(e))n.el.style.cssText=e;else{for(var r in e){var i=e[r];(null==l||null!=i&&i!==l[r])&&(n.el.style[r]=k(r,i))}if(l)for(var o in l)null==e[o]&&(n.el.style[o]="")}}function w(n,t,e,l,r){if(null!=n){var i=e.hooks[t];if(i){if("d"!==t[0]||"i"!==t[1]||"d"!==t[2])return i(e,l);r?c(e.parent)&&i(e,l):wn.push([i,e,l])}}}function x(n){if(wn.length){c(n.node);for(var t;t=wn.shift();)t[0](t[1],t[2])}}function N(n){return n.nextSibling}function S(n){var t=n.vm,e=null!=t&&w(t.hooks,"willUnmount",t,t.data),l=w(n.hooks,"willRemove",n);if((n.flags&mn)===mn&&vn(n.body))for(var r=0;r<n.body.length;r++)S(n.body[r]);return e||l}function A(n,t,e){var l=t._node,r=l.vm;if(vn(l.body))if((l.flags&mn)===mn)for(var i=0;i<l.body.length;i++)A(t,l.body[i].el);else E(l);delete t._node,n.removeChild(t),w(l.hooks,"didRemove",l,null,e),null!=r&&(w(r.hooks,"didUnmount",r,r.data,e),r.node=null)}function C(n,t){var e=t._node;if(!e._dead){var r=S(e);null!=r&&function(n){return"object"==typeof n&&l(n.then)}(r)?(e._dead=!0,r.then(function(n,t,e){return function(){return n.apply(e,t)}}(A,[n,t,!0]))):A(n,t)}}function E(n){for(var t=n.body,e=0;e<t.length;e++){var l=t[e];delete l.el._node,null!=l.vm&&(l.vm.node=null),vn(l.body)&&E(l)}}function R(n){var t=n.el;if(0==(n.flags&mn))vn(n.body)&&E(n),t.textContent=null;else{var e=t.firstChild;do{var l=N(e);C(t,e)}while(e=l)}}function O(n,t,e){var l=t._node,r=null!=t.parentNode,i=t!==e&&r?null:l.vm;null!=i&&w(i.hooks,"willMount",i,i.data),w(l.hooks,r?"willReinsert":"willInsert",l),n.insertBefore(t,e),w(l.hooks,r?"didReinsert":"didInsert",l),null!=i&&w(i.hooks,"didMount",i,i.data)}function I(n,t,e){O(n,t,e?N(e):null)}function V(n,t,e){n[t]=e}function D(n,t,e,l,r){var i=n.apply(r,t.concat([e,l,r,r.data]));r.onevent(e,l,r,r.data,t),Nn.call(null,e,l,r,r.data,t),!1===i&&(e.preventDefault(),e.stopPropagation())}function j(n){var t,e,l=function(n){for(;null==n._node;)n=n.parentNode;return n._node}(n.target),r=y(l),i=n.currentTarget._node.attrs["on"+n.type];if(vn(i))D(t=i[0],e=i.slice(1),n,l,r);else for(var o in i)if(n.target.matches(o)){var u=i[o];vn(u)?(t=u[0],e=u.slice(1)):(t=u,e=[]),D(t,e,n,l,r)}}function M(n,t,e,r){if(e!==r){var i=n.el;null==e||l(e)?V(i,t,e):null==r&&V(i,t,j)}}function T(n,t,e){"."===t[0]&&(t=t.substr(1),e=!0),e?n.el[t]="":n.el.removeAttribute(t)}function L(n,t,e,l,r){var i=n.el;null!=n.ns?i.setAttribute(t,e):"class"===t?i.className=e:"id"===t||"boolean"==typeof e||l?i[t]=e:"."===t[0]?i[t.substr(1)]=e:i.setAttribute(t,e)}function U(n,t,e){var l=n.attrs||cn,r=t.attrs||cn;if(l===r);else{for(var i in l){var o=l[i];if(null!=o){var u=h(n.tag,i),a=u?n.el[i]:r[i];o===a||(d(i)?_(n,t):s(i)||(f(i)?M(n,i,o,a):L(n,i,o,u)))}}for(var i in r)null==l[i]&&!s(i)&&T(n,i,h(n.tag,i)||f(i))}}function z(n,t,e,l){return n.type===on&&(t=n.data,e=n.key,l=n.opts,n=n.view),new X(n,t,e,l)}function F(n){for(var t=0;t<n.body.length;t++){var e=n.body[t],l=e.type;if(l<=rn)O(n.el,G(e));else if(l===on){l=(r=z(e.view,e.data,e.key,e.opts)._redraw(n,t,!1)).node.type,O(n.el,G(r.node))}else if(l===un){var r;(r=e.vm)._redraw(n,t),l=r.node.type,O(n.el,r.node.el)}}}function G(n,t){return null==n.el&&(n.type===en?(n.el=t||function(n,t){return null!=t?sn.createElementNS(t,n):sn.createElement(n)}(n.tag,n.ns),null!=n.attrs&&U(n,cn),(n.flags&kn)===kn&&n.body.body(n),vn(n.body)?F(n):null!=n.body&&(n.el.textContent=n.body)):n.type===ln?n.el=t||function(n){return sn.createTextNode(n)}(n.body):n.type===rn&&(n.el=t||function(n){return sn.createComment(n)}(n.body))),n.el._node=n,n.el}function P(n,t,e,l,r,i,o,u){return function(a,f,s,d,c,v){var h,y;if(null!=d[l]){if(null==(h=d[l]._node))return void(d[l]=n(d[l]));if(function(n){return n.parent}(h)!==a)return y=n(d[l]),null!=h.vm?h.vm.unmount(!0):C(f,d[l]),void(d[l]=y)}if(d[r]==c)return Cn;if(null==d[r].el)e(f,G(d[r]),d[l]),d[r]=t(d[r],s);else if(d[r].el===d[l])d[r]=t(d[r],s),d[l]=n(d[l]);else{if(v||h!==d[o])return v&&null!=d[l]?function(n,t,e,l,r,i,o,u,a){if(u._lis)e(i,a[r].el,a[l]),a[r]=t(a[r],o);else{var f=function(n,t){var e,l=0,r=t.length-1;if(r<=2147483647)for(;l<=r;){if(e=l+r>>1,t[e]===n)return e;t[e]<n?l=e+1:r=e-1}else for(;l<=r;){if(e=Math.floor((l+r)/2),t[e]===n)return e;t[e]<n?l=e+1:r=e-1}return l==t.length?null:l}(u.idx,a.tombs);u._lis=!0;var s=n(a[l]);e(i,a[l],null!=f?o[a.tombs[f]].el:f),null==f?a.tombs.push(u.idx):a.tombs.splice(f,0,u.idx),a[l]=s}}(n,t,e,l,r,f,s,h,d):An;y=d[l],d[l]=n(y),u(f,y,d[i]),d[i]=y}}}function W(n,t){var e=t.body,l=n.el,r=n.body,i={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(e[0]||cn).el,rgtSib:(e[e.length-1]||cn).el};n:for(;;){for(;;){var o=En(n,l,r,i,null,!1);if(o===An)break;if(o===Cn)break n}for(;;){var u=Rn(n,l,r,i,i.lftNode,!1);if(u===An)break;if(u===Cn)break n}!function(n,t,e,l){for(var r=Array.prototype.slice.call(t.childNodes),i=[],o=0;o<r.length;o++){var u=r[o]._node;u.parent===n&&i.push(u.idx)}for(var a=function(n){var t=n.slice(),e=[];e.push(0);for(var l,r,i=0,o=n.length;i<o;++i){var u=e[e.length-1];if(n[u]<n[i])t[i]=u,e.push(i);else{for(l=0,r=e.length-1;l<r;){var a=(l+r)/2|0;n[e[a]]<n[i]?l=a+1:r=a}n[i]<n[e[l]]&&(l>0&&(t[i]=e[l-1]),e[l]=i)}}for(r=e[(l=e.length)-1];l-- >0;)e[l]=r,r=t[r];return e}(i).map(function(n){return i[n]}),f=0;f<a.length;f++)e[a[f]]._lis=!0;l.tombs=a;for(;;){var s=En(n,t,e,l,null,!0);if(s===Cn)break}}(n,l,r,i);break}}function Y(n){return n.el._node.parent!==n.parent}function B(n,t,e){return t[e]}function H(n,t,e){for(;e<t.length;e++){var l=t[e];if(null!=l.vm){if(n.type===on&&l.vm.view===n.view&&l.vm.key===n.key||n.type===un&&l.vm===n.vm)return l}else if(!Y(l)&&n.tag===l.tag&&n.type===l.type&&n.key===l.key&&(n.flags&~mn)==(l.flags&~mn))return l}return null}function q(n,t,e){if(null==t._keys){if(t[e].key===n.key)return t[e];for(var l={},r=0;r<t.length;r++)l[t[r].key]=r;t._keys=l}return t[t._keys[n.key]]}function K(t,e){w(e.hooks,"willRecycle",e,t);var l=t.el=e.el,r=e.body,i=t.body;if(l._node=t,t.type!==ln||i===r){null==t.attrs&&null==e.attrs||U(t,e);var o=vn(r),u=vn(i),a=(t.flags&kn)===kn;o?u||a?function(t,e){var l=t.body,r=l.length,i=e.body,o=i.length,u=(t.flags&kn)===kn,a=(t.flags&gn)===gn,f=(t.flags&bn)===bn,s=!a&&t.type===en,d=!0,c=0===o?n:f?q:a||u?B:H;if(s&&0===r)return R(e),void(u&&(t.body=[]));var h,y,p=0,m=!1,g=0;if(u)var k={key:null},_=Array(r);for(var w=0;w<r;w++){if(u){var x=!1,N=null;d&&(f&&(k.key=l.key(w)),h=c(k,i,g)),null!=h?(y=h.idx,!0===(N=l.diff(w,h))?((S=h).parent=t,S.idx=w,S._lis=!1):x=!0):x=!0,x&&(b(S=l.tpl(w),t,w),S._diff=null!=N?N:l.diff(w),null!=h&&K(S,h)),_[w]=S}else{var S=l[w],A=S.type;if(A<=rn)(h=d&&c(S,i,g))&&(K(S,h),y=h.idx);else if(A===on){if(h=d&&c(S,i,g)){y=h.idx;var C=h.vm._update(S.data,t,w)}else var C=z(S.view,S.data,S.key,S.opts)._redraw(t,w,!1);A=C.node.type}else if(A===un){var E=v(S.vm),C=S.vm._update(S.data,t,w,E);A=C.node.type}}if(null!=h&&(y===g?++g===o&&r>o&&(h=null,d=!1):m=!0,!f&&o>100&&m&&++p%10==0))for(;g<o&&Y(i[g]);)g++}u&&(t.body=_);s&&W(t,e)}(t,e):i!==r&&(null!=i?l.textContent=i:R(e)):u?(R(e),F(t)):i!==r&&(null!=i&&null!=r?l.firstChild.nodeValue=i:l.textContent=i),w(e.hooks,"didRecycle",e,t)}else l.nodeValue=i}function X(n,e,r,i){var o=this;o.view=n,o.data=e,o.key=r,i&&(o.opts=i,o.config(i));var u=t(n)?n:n.call(o,o,e,r,i);l(u)?o.render=u:(o.render=u.render,o.config(u)),o._redrawAsync=a(function(n){return o.redraw(!0)}),o._updateAsync=a(function(n){return o.update(n,!0)}),o.init&&o.init.call(o,o,o.data,o.key,i)}function Z(n,t,e,l){return null!=e&&(e.body[l]=t,t.idx=l,t.parent=e,t._lis=!1),n}function J(n,e,l,r){var i,o;return null==l?t(e)?i=e:o=e:(i=e,o=l),g(n,i,o,r)}function Q(n,t,e,l){this.view=n,this.data=t,this.key=e,this.opts=l}function $(n){this.vm=n}function nn(n,t){var e=n.body;if(vn(e))for(var l=0;l<e.length;l++){var r=e[l];null!=r.vm?t.push(r.vm):nn(r,t)}return t}function tn(n){var e,l,r=arguments,o=r.length;if(o>1){var u=1;t(r[1])&&(l=r[1],u=2),e=o!==u+1||r[u]instanceof p||r[u]instanceof Q||r[u]instanceof $?i(r,u):r[u]}return g(n,l,e)}var en=1,ln=2,rn=3,on=4,un=5,an="undefined"!=typeof window,fn=an?window:{},sn=an?document:{},dn=fn.requestAnimationFrame,cn={},vn=Array.isArray,hn=p.prototype={constructor:p,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null},yn={},pn=/\[(\w+)(?:=(\w+))?\]/g,mn=1,gn=2,bn=4,kn=8,_n={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wn=[],xn={},Nn=n,Sn=!1,An=1,Cn=2,En=P(N,function(n,t){return t[n.idx+1]},O,"lftSib","lftNode","rgtSib","rgtNode",I),Rn=P(function(n){return n.previousSibling},function(n,t){return t[n.idx-1]},I,"rgtSib","rgtNode","lftSib","lftNode",O),On=X.prototype={constructor:X,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:n,refs:null,render:null,mount:function(n,t){return t?(R({el:n,flags:0}),this._redraw(null,null,!1),n.nodeName.toLowerCase()!==this.node.tag?(G(this.node),O(n.parentNode,this.node.el,n),n.parentNode.removeChild(n)):O(n.parentNode,G(this.node,n),n)):(this._redraw(null,null),n&&O(n,this.node.el)),n&&x(this),this},unmount:function(n){var t=this.node;C(t.el.parentNode,t.el),n||x(this)},config:function(n){n.init&&(this.init=n.init),n.diff&&(this.diff=n.diff),n.onevent&&(this.onevent=n.onevent),n.hooks&&(this.hooks=r(this.hooks||{},n.hooks)),n.onemit&&(this.onemit=r(this.onemit||{},n.onemit))},parent:function(){return y(this.node.parent)},root:function(){for(var n=this.node;n.parent;)n=n.parent;return n.vm},redraw:function(n){null==n&&(n=Sn);return n?this._redraw(null,null,v(this)):this._redrawAsync(),this},update:function(n,t){null==t&&(t=Sn);return t?this._update(n,null,null,v(this)):this._updateAsync(n),this},_update:function(n,t,e,l){return null!=n&&this.data!==n&&(w(this.hooks,"willUpdate",this,n),this.data=n),this._redraw(t,e,l)},_redraw:function(n,t,e){var l,r,i=null==n,a=this.node&&this.node.el&&this.node.el.parentNode,f=this.node;if(null!=this.diff&&(l=this._diff,this._diff=r=this.diff(this,this.data),null!=f)){var s=vn(l)?u:o;if(l===r||s(l,r))return Z(this,f,n,t)}a&&w(this.hooks,"willRedraw",this,this.data);var d=this.render.call(this,this,this.data,l,r);if(d===f)return Z(this,f,n,t);if(this.refs=null,null!=this.key&&d.key!==this.key&&(d.key=this.key),this.node=d,n?(b(d,n,t,this),n.body[t]=d):f&&f.parent?(b(d,f.parent,f.idx,this),f.parent.body[f.idx]=d):b(d,null,null,this),!1!==e)if(f)if(f.tag!==d.tag||f.key!==d.key){f.vm=d.vm=null;var c=f.el.parentNode,v=N(f.el);C(c,f.el),O(c,G(d),v),f.el=d.el,d.vm=this}else K(d,f);else G(d);return a&&w(this.hooks,"didRedraw",this,this.data),i&&a&&x(this),this},_redrawAsync:null,_updateAsync:null},In="http://www.w3.org/2000/svg";Q.prototype={constructor:Q,type:on,view:null,data:null,key:null,opts:null},$.prototype={constructor:$,type:un,vm:null};var Vn={config:function(n){Nn=n.onevent||Nn,null!=n.syncRedraw&&(Sn=n.syncRedraw),n.onemit&&function(n){r(xn,n)}(n.onemit)},ViewModel:X,VNode:p,createView:z,defineElement:J,defineSvgElement:function(n,t,e,l){var r=J(n,t,e,l);return r.ns=In,r},defineText:m,defineComment:function(n){var t=new p;return t.type=rn,t.body=n,t},defineView:function(n,t,e,l){return new Q(n,t,e,l)},injectView:function(n){return new $(n)},injectElement:function(n){var t=new p;return t.type=en,t.el=t.key=n,t},lazyList:function(n,t){var e=n.length,l={items:n,length:e,key:function(e){return t.key(n[e],e)},diff:function(e,l){var r=t.diff(n[e],e);if(null==l)return r;var i=l._diff;return(r===i||vn(i)?u(r,i):o(r,i))||r},tpl:function(e){return t.tpl(n[e],e)},map:function(n){return t.tpl=n,l},body:function(n){for(var t=Array(e),r=0;r<e;r++){var i=l.tpl(r);i._diff=l.diff(r),t[r]=i,b(i,n,r)}n.body=t}};return l},FIXED_BODY:gn,DEEP_REMOVE:mn,KEYED_LIST:bn,LAZY_LIST:kn};return hn.patch=function(n,t){!function(n,t,e){if(null!=t.type){if(null!=n.vm)return;b(t,n.parent,n.idx,null),n.parent.body[n.idx]=t,K(t,n),e&&c(t),x(y(t))}else{var l=Object.create(n);l.attrs=r({},n.attrs);var i=r(n.attrs,t);if(null!=n._class){var o=i.class;i.class=null!=o&&""!==o?n._class+" "+o:n._class}U(n,l),e&&c(n)}}(this,n,t)},On.emit=function(n){var t=this,e=t,l=i(arguments,1).concat(e,e.data);do{var r=t.onemit,o=r?r[n]:null;if(o){o.apply(t,l);break}}while(t=t.parent());xn[n]&&xn[n].apply(t,l)},On.onemit=null,On.body=function(){return nn(this.node,[])},Vn.defineElementSpread=tn,Vn.defineSvgElementSpread=function(){var n=tn.apply(null,arguments);return n.ns=In,n},Vn});