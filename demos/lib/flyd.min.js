/* istanbul ignore file */
(function(u,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):u.flyd=n()})(this,function(){function u(a){return!!(a&&a.constructor&&a.call&&a.apply)}function n(){return!0}function h(a,c){var b,d,e,g=y([],n);d=[];e=[];for(b=0;b<c.length;++b)void 0!==c[b]&&(d.push(c[b]),void 0!==c[b].end&&e.push(c[b].end));b=y(d,a);b.depsChanged=[];b.fnArgs=b.deps.concat([b,b.depsChanged]);b.end=g;g.listeners.push(b);B(e,g);g.deps=e;z(b);return b}
function J(a){return f.map(a,this)}function K(a){return h(function(a,b,d){d(a.val(b.val))},[this,a])}function L(){return"stream("+this.val+")"}function C(){function a(c){if(0===arguments.length)return a.val;if(void 0!==c&&null!==c&&u(c.then))c.then(a);else if(a.val=c,a.hasVal=!0,void 0===p)q=!0,D(a),0<r.length?E():q=!1;else if(p===a){var b=a.listeners,d,e;for(d=0;d<b.length;++d)e=b[d],e.end!==a?(void 0!==e.depsChanged&&e.depsChanged.push(a),e.shouldUpdate=!0):F(e)}else a.vals.push(c),r.push(a);return a}
a.hasVal=!1;a.val=void 0;a.vals=[];a.listeners=[];a.queued=!1;a.end=void 0;a.map=J;a.ap=K;a.of=f.stream;a.toString=L;return a}function y(a,c){var b=C();b.fn=c;b.deps=a;b.depsMet=!1;b.depsChanged=0<a.length?[]:void 0;b.shouldUpdate=!1;B(a,b);return b}function M(a){a.depsMet=a.deps.every(function(a){return a.hasVal});return!a.depsMet}function z(a){if(!(!0!==a.depsMet&&M(a)||void 0!==a.end&&!0===a.end.val))if(void 0!==p)r.push(a);else{p=a;a.depsChanged&&(a.fnArgs[a.fnArgs.length-1]=a.depsChanged);var c=
a.fn.apply(a.fn,a.fnArgs);void 0!==c&&a(c);p=void 0;void 0!==a.depsChanged&&(a.depsChanged=[]);a.shouldUpdate=!1;!1===q&&E()}}function D(a){var c,b,d=a.listeners;for(c=0;c<d.length;++c)b=d[c],b.end===a?F(b):(void 0!==b.depsChanged&&b.depsChanged.push(a),b.shouldUpdate=!0,G(b));for(;0<=v;--v)a=H[v],!0===a.shouldUpdate&&z(a),a.queued=!1}function G(a){var c,b=a.listeners;if(!1===a.queued){a.queued=!0;for(c=0;c<b.length;++c)G(b[c]);H[++v]=a}}function E(){for(q=!0;0<r.length;){var a=r.shift();0<a.vals.length&&
(a.val=a.vals.shift());D(a)}q=!1}function B(a,c){for(var b=0;b<a.length;++b)a[b].listeners.push(c)}function A(a){for(var c=0;c<a.deps.length;++c){var b=a.deps[c].listeners,d=b.indexOf(a);b[d]=b[b.length-1];b.length--}a.deps.length=0}function F(a){void 0!==a.deps&&A(a);void 0!==a.end&&A(a.end)}function w(){}var I=function(a,c){switch(a){case 0:return function(){return c.apply(this,arguments)};case 1:return function(a){return c.apply(this,arguments)};case 2:return function(a,d){return c.apply(this,
arguments)};case 3:return function(a,d,e){return c.apply(this,arguments)};case 4:return function(a,d,e,g){return c.apply(this,arguments)};case 5:return function(a,d,e,g,t){return c.apply(this,arguments)};case 6:return function(a,d,e,g,t,f){return c.apply(this,arguments)};case 7:return function(a,d,e,g,t,f,m){return c.apply(this,arguments)};case 8:return function(a,d,e,g,t,f,m,h){return c.apply(this,arguments)};case 9:return function(a,d,e,g,t,f,m,h,l){return c.apply(this,arguments)};case 10:return function(a,
d,e,g,t,f,h,l,k,n){return c.apply(this,arguments)};default:throw Error("First argument to _arity must be a non-negative integer no greater than ten");}},l=function(a){return null!=a&&"object"===typeof a&&!0===a["@@functional/placeholder"]},x=function(a){return function b(d){return 0===arguments.length||l(d)?b:a.apply(this,arguments)}},N=function c(b,d,e){return function(){for(var g=[],f=0,h=b,m=0;m<d.length||f<arguments.length;){var k;m<d.length&&(!l(d[m])||f>=arguments.length)?k=d[m]:(k=arguments[f],
f+=1);g[m]=k;l(k)||--h;m+=1}return 0>=h?e.apply(this,g):I(h,c(b,g,e))}},k=function(c){return function d(e,g){switch(arguments.length){case 0:return d;case 1:return l(e)?d:x(function(d){return c(e,d)});default:return l(e)&&l(g)?d:l(e)?x(function(d){return c(d,g)}):l(g)?x(function(d){return c(e,d)}):c(e,g)}}}(function(c,b){return 1===c?x(b):I(c,N(c,[],b))}),r=[],p,H=[],v=-1,q=!1,f={stream:function(c){var b=y([],n),d=C();d.end=b;d.fnArgs=[];b.listeners.push(d);0<arguments.length&&d(c);return d}};f.combine=
k(2,h);f.isStream=function(c){return u(c)&&"hasVal"in c};f.immediate=function(c){!1===c.depsMet&&(c.depsMet=!0,z(c));return c};f.endsOn=function(c,b){A(b.end);c.listeners.push(b.end);b.end.deps.push(c);return b};f.map=k(2,function(c,b){return h(function(b,e){e(c(b.val))},[b])});f.on=k(2,function(c,b){return h(function(b){c(b.val)},[b])});f.scan=k(3,function(c,b,d){d=h(function(d,g){g(b=c(b,d.val))},[d]);d.hasVal||d(b);return d});f.merge=k(2,function(c,b){var d=f.immediate(h(function(b,c,d,f){f[0]?
d(f[0]()):b.hasVal?d(b.val):c.hasVal&&d(c.val)},[c,b]));f.endsOn(h(function(){return!0},[c.end,b.end]),d);return d});f.transduce=k(2,function(c,b){c=c(new w);return h(function(b,e){var d=c["@@transducer/step"](void 0,b.val);return d&&!0===d["@@transducer/reduced"]?(e.end(!0),d["@@transducer/value"]):d},[b])});f.curryN=k;w.prototype["@@transducer/init"]=function(){};w.prototype["@@transducer/result"]=function(){};w.prototype["@@transducer/step"]=function(c,b){return b};return f});
